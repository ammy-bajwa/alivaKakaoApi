(this["webpackJsonpaliva-kakao-client-ts"]=this["webpackJsonpaliva-kakao-client-ts"]||[]).push([[0],{156:function(e,t,n){},163:function(e,t){},165:function(e,t){},175:function(e,t){},177:function(e,t){},204:function(e,t){},205:function(e,t){},210:function(e,t){},212:function(e,t){},219:function(e,t){},238:function(e,t){},279:function(e,t,n){},280:function(e,t,n){},281:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},284:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(40),s=n.n(c),o=n(9),u=(n(156),n(157),n(92)),i=n(5),l={user:{email:"",chatList:{},accessToken:""},loggedInUserId:"",chat:[],currentFocus:"",ws:null,loading:!1,isSending:!1,chatLoading:!1},p=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.a,d=Object(u.b)((function(){var e,t,n,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,c=arguments.length>1?arguments[1]:void 0;switch(c.type){case"LOGIN":return console.log(c),a=Object(i.a)(Object(i.a)({},a),{},{user:{email:null===(e=c.payload)||void 0===e?void 0:e.email,chatList:null===(t=c.payload)||void 0===t?void 0:t.chatList,accessToken:null===(n=c.payload)||void 0===n?void 0:n.accessToken},loggedInUserId:null===(r=c.payload)||void 0===r?void 0:r.loggedInUserId,chat:[]});case"LOGOUT":return a=Object(i.a)(Object(i.a)({},a),{},{user:{email:"",chatList:{},accessToken:""}});case"LOAD_CHAT":return a=Object(i.a)(Object(i.a)({},a),{},{chat:c.payload});case"START_LOADING":return a=Object(i.a)(Object(i.a)({},a),{},{loading:!0});case"STOP_LOADING":return a=Object(i.a)(Object(i.a)({},a),{},{loading:!1});case"START_CHAT_LOADING":return a=Object(i.a)(Object(i.a)({},a),{},{chatLoading:!0});case"STOP_CHAT_LOADING":return a=Object(i.a)(Object(i.a)({},a),{},{chatLoading:!1});case"SET_FOCUSED_USER":return a=Object(i.a)(Object(i.a)({},a),{},{currentFocus:c.payload});case"SET_WS":return a=Object(i.a)(Object(i.a)({},a),{},{ws:c.payload});case"SET_CONTACT_LIST":return a=Object(i.a)(Object(i.a)({},a),{},{user:Object(i.a)(Object(i.a)({},a.user),{},{chatList:c.payload})});case"SET_SENDING":return a=Object(i.a)(Object(i.a)({},a),{},{isSending:c.payload});case"NEW_MESSAGE":var s=c.payload,o=s.receiverUserName,u=s.message,p=s.senderName;return a=Object(i.a)(Object(i.a)({},a),{},{chat:a.chat.concat([Object(i.a)(Object(i.a)({receiverUserName:o},u),{},{senderName:p})])});default:return a}}),p()),b=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,287)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))},f=n(42),m=n(43),h=n(45),v=n(44),j=n(24),x=n(46),O=n(0),g=n.n(O),k=n(3),w=n(10),y=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise((function(e,n){setTimeout((function(){e(!0)}),t)})),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S={12:"LOGIN_FAILED_REASON",13:"TOO_MANY_TRY_LOGIN",30:"LOGIN_FAILED",32:"MOBILE_UNREGISTERED","-100":"DEVICE_NOT_REGISTERED","-101":"ANOTHER_LOGON","-102":"DEVICE_REGISTER_FAILED","-110":"INVALID_DEVICE_REGISTER","-111":"INCORRECT_PASSCODE","-112":"PASSCODE_REQUEST_FAILED","-997":"ACCOUNT_RESTRICTED"},N=function(e){var t=document.getElementById("loginTryMessage");t&&(t.innerText=e)},I=n(11),T=n(12),A=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u,i,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(I.SHA256)("KakaoUserMedia").toString(),c="mediaStore",s=Object(I.SHA256)(t.attachment.thumbnailUrl).toString(),t.attachment.thumbnailKey=s,o=Object(I.SHA256)(t.attachment.url).toString(),t.attachment.urlKey=o,e.next=9,Object(T.b)(a,1,{upgrade:function(e){return Object(k.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.createObjectStore(c);case 1:case"end":return t.stop()}}),t)})))()}});case 9:return u=e.sent,e.next=12,u.get(c,s);case 12:return i=e.sent,e.next=15,u.get(c,o);case 15:if(l=e.sent,i){e.next=20;break}return console.log("Img message: ",t),e.next=20,u.put(c,new Blob([t.attachment.thumbnailUrlBase64],{type:t.attachment.mt}),s);case 20:if(l){e.next=23;break}return e.next=23,u.put(c,new Blob([t.attachment.urlBase64],{type:t.attachment.mt}),o);case 23:u.close(),n(!0),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),r(!1);case 30:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u,i,l,p,d,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(I.SHA256)("KakaoUserMedia").toString(),c="mediaStore",e.next=5,Object(T.b)(a,1,{upgrade:function(e){return Object(k.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.createObjectStore(c);case 1:case"end":return t.stop()}}),t)})))()}});case 5:s=e.sent,t.attachment.thumbnailKeys=[],t.attachment.urlKeys=[],o=0;case 9:if(!(o<t.attachment.thumbnailUrlsBase64.length)){e.next=32;break}return u=Object(I.SHA256)(t.attachment.thumbnailUrls[o]).toString(),t.attachment.thumbnailKeys.push(u),console.log(t.attachment.thumbnailKeys),i=Object(I.SHA256)(t.attachment.imageUrls[o]).toString(),t.attachment.urlKeys.push(i),l=t.attachment.thumbnailUrlsBase64[o],p=t.attachment.urlsBase64[o],e.next=19,s.get(c,u);case 19:return d=e.sent,e.next=22,s.get(c,i);case 22:if(b=e.sent,d){e.next=26;break}return e.next=26,s.put(c,new Blob([l],{type:t.attachment.mtl[o]}),u);case 26:if(b){e.next=29;break}return e.next=29,s.put(c,new Blob([p],{type:t.attachment.mtl[o]}),i);case 29:o++,e.next=9;break;case 32:s.close(),n(!0),e.next=39;break;case 36:e.prev=36,e.t0=e.catch(0),r(e.t0);case 39:case"end":return e.stop()}}),e,null,[[0,36]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=Object(I.SHA256)("KakaoUserMedia").toString(),c="mediaStore",!t.attachment.url){e.next=18;break}return s=Object(I.SHA256)(t.attachment.url).toString(),e.next=7,Object(T.b)(a,1,{upgrade:function(e){return Object(k.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.createObjectStore(c);case 1:case"end":return t.stop()}}),t)})))()}});case 7:return o=e.sent,e.next=10,o.get(c,s);case 10:if(e.sent){e.next=16;break}if(console.log("Img message: ",t),!t.attachment.audioBase64){e.next=16;break}return e.next=16,o.put(c,new Blob([t.attachment.audioBase64],{type:"audio/mpeg"}),s);case 16:o.close(),n(!0);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),r(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(k.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(r,a){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(g.a.mark((function e(){var a,c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(I.SHA256)("KAKAOCONTACTS".concat(n)).toString(),c="ContactStore",e.next=4,Object(T.b)(a,1,{upgrade:function(e){e.createObjectStore(c)}});case 4:return s=e.sent,e.next=7,Object(T.b)("".concat(n,"_message_logs"),1,{upgrade:function(e){e.createObjectStore("myLogsData")}});case 7:o=e.sent,e.t0=g.a.keys(t);case 9:if((e.t1=e.t0()).done){e.next=15;break}if(u=e.t1.value,!Object.prototype.hasOwnProperty.call(t,u)){e.next=13;break}return e.delegateYield(g.a.mark((function e(){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t[u],e.next=3,s.put(c,n,n.intId);case 3:n.messages.forEach(function(){var e=Object(k.a)(g.a.mark((function e(t){var r,a,c,s,u,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="".concat(n.displayUserList[0].nickname,"__").concat(n.intId,"__").concat(t.logId),"photo"!==(null===t||void 0===t?void 0:t.text)&&"\uc0ac\uc9c4"!==(null===t||void 0===t?void 0:t.text)||!(null===t||void 0===t?void 0:t.attachment)||!(null===t||void 0===t||null===(r=t.attachment)||void 0===r?void 0:r.thumbnailUrlBase64)||!(null===t||void 0===t||null===(a=t.attachment)||void 0===a?void 0:a.urlBase64)){e.next=6;break}return e.next=4,A(t);case 4:e.next=14;break;case 6:if(!(null===(c=t.attachment)||void 0===c?void 0:c.thumbnailUrlsBase64)||!(null===(s=t.attachment)||void 0===s?void 0:s.urlsBase64)){e.next=11;break}return e.next=9,E(t);case 9:e.next=14;break;case 11:if("voice note"!==t.text||!(null===(u=t.attachment)||void 0===u?void 0:u.url)){e.next=14;break}return e.next=14,L(t);case 14:return e.next=16,o.put("myLogsData",t,i);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)}))(),"t2",13);case 13:e.next=9;break;case 15:s.close(),setTimeout((function(){o.close()}),1e3),r(!0);case 18:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:e.next=8;break;case 4:e.prev=4,e.t1=e.catch(0),a(e.t1),console.error(e.t1);case 8:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=Object(k.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(r,a){var c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=Object(I.SHA256)("KAKAOLOGID".concat(t)).toString(),s="logs",o="logId",e.next=6,Object(T.b)(c,1,{upgrade:function(e){e.createObjectStore(s)}});case 6:return u=e.sent,e.next=9,u.put(s,n,o);case 9:u.close(),r(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),a(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(I.SHA256)("KAKAOLOGID".concat(t)).toString(),c="logs",s="logId",e.next=6,Object(T.b)(a,1,{upgrade:function(e){e.createObjectStore(c)}});case 6:return o=e.sent,e.next=9,o.get(c,s);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=0;case 12:u=e.t0,o.close(),n(u),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),r(e.t1),console.error(e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(a,c){var s,o,u,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=Object(I.SHA256)("KAKAOCHAT".concat(n).concat(r)).toString(),o="MessageStore",u="messages",e.next=6,Object(T.b)(s,1,{upgrade:function(e){e.createObjectStore(o)}});case 6:return i=e.sent,e.next=9,i.put(o,t,u);case 9:i.close(),a(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),c(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,a;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r){var a,c,s,o,u,l,p,d;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(I.SHA256)("KAKAOCHAT".concat(t).concat(n)).toString(),c="MessageStore",s="messages",o=!1,e.next=6,Object(T.b)(a,1,{upgrade:function(e){o=!0,e.createObjectStore(c)}});case 6:if(u=e.sent,l=Object(i.a)({receiverUserName:r.receiverUserName,senderName:r.senderName},r.message),!o){e.next=15;break}return e.next=11,u.put(c,[l],s);case 11:return u.close(),e.abrupt("return");case 15:return e.next=17,u.get(c,s);case 17:return p=e.sent,d=p.concat([l]),e.next=21,u.put(c,d,s);case 21:return u.close(),e.abrupt("return",p);case 23:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=Object(k.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(r,a){var c,s,o,u,i,l,p,d;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=Object(I.SHA256)("KAKAOCHAT".concat(t).concat(n)).toString(),s="MessageStore",o="messages",u=!1,e.next=7,Object(T.b)(c,1,{upgrade:function(e){u=!0}});case 7:if(i=e.sent,!u){e.next=15;break}return r({allMessages:[],lastMessageTimeStamp:0,logId:0}),i.close(),e.next=13,Object(T.a)(c);case 13:e.next=19;break;case 15:return e.next=17,i.get(s,o);case 17:d=e.sent,r({allMessages:d||[],lastMessageTimeStamp:(null===(l=d[d.length-1])||void 0===l?void 0:l.sendAt)||0,logId:(null===(p=d[d.length-1])||void 0===p?void 0:p.logId)||0});case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),a(e.t0),console.error(e.t0);case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(k.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(r,a){var c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=Object(I.SHA256)("KAKAOTIMESTAMP".concat(t)).toString(),s="time",o="timeStamp",e.next=6,Object(T.b)(c,1,{upgrade:function(e){e.createObjectStore(s)}});case 6:return u=e.sent,e.next=9,u.put(s,n,o);case 9:u.close(),r(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),a(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(I.SHA256)("KAKAOTIMESTAMP".concat(t)).toString(),c="time",s="timeStamp",e.next=6,Object(T.b)(a,1,{upgrade:function(e){e.createObjectStore(c)}});case 6:return o=e.sent,e.next=9,o.get(c,s);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=0;case 12:u=e.t0,o.close(),n(u),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),r(e.t1),console.error(e.t1);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(k.a)(g.a.mark((function e(t,n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(r,a){var c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=g.a.keys(n);case 2:if((e.t1=e.t0()).done){e.next=8;break}if(c=e.t1.value,!Object.prototype.hasOwnProperty.call(n,c)){e.next=6;break}return e.delegateYield(g.a.mark((function e(){var r,a,s,o,u,i,l,p,d,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[c],a=r.intId,s=r.messages,o=Object(I.SHA256)("KAKAOCHAT".concat(t).concat(a)).toString(),u="MessageStore",i="messages",l=!1,e.next=7,Object(T.b)(o,1,{upgrade:function(e){l=!0,e.createObjectStore(u)}});case 7:if(p=e.sent,!l){e.next=14;break}return e.next=11,p.put(u,s,i);case 11:p.close(),e.next=21;break;case 14:return e.next=16,p.get(u,i);case 16:return d=e.sent,b=d.concat(s),e.next=20,p.put(u,b,i);case 20:p.close();case 21:case"end":return e.stop()}}),e)}))(),"t2",6);case 6:e.next=2;break;case 8:r(!0),e.next=15;break;case 11:e.prev=11,e.t3=e.catch(0),console.error(e.t3),a(e.t3);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r,a,c){var s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(s,o){var u,i,l,p;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u="".concat(t,"_message_logs"),i="myLogsData",l="".concat(n,"__").concat(r,"__").concat(c),e.next=6,Object(T.b)(u,1,{upgrade:function(e){e.createObjectStore(i)}});case 6:return p=e.sent,e.next=9,p.put(i,a,l);case 9:p.close(),s(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),o(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,s;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),G=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(I.SHA256)("KakaoUserMedia").toString(),c="mediaStore",e.next=5,Object(T.b)(a,1,{upgrade:function(e){e.createObjectStore(c)}});case 5:return s=e.sent,e.next=8,s.get(c,t);case 8:o=e.sent,n(o),s.close(),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),r(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(e){return{type:"LOGIN",payload:e}},J=function(e){return{type:"NEW_MESSAGE",payload:e}},W=function(e){return{type:"LOAD_CHAT",payload:e}},Y=function(e){return{type:"SET_CONTACT_LIST",payload:e}},q=function(e){return{type:"SET_SENDING",payload:e}},V=function(){d.dispatch({type:"START_LOADING",payload:null})},X=function(){d.dispatch({type:"STOP_LOADING",payload:null})},z=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r,a,c){var s,o,u,i,l=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>5&&void 0!==l[5]?l[5]:0,o=l.length>6&&void 0!==l[6]?l[6]:"",u=l.length>7&&void 0!==l[7]?l[7]:"",i=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(i,l){var p,b,f,m,h,v,j,x,O,k;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p=d.getState(),b=p.user.accessToken,console.log("accessToken: ",b),m="",b){e.next=40;break}V(),h=0;case 7:if(!(h<15)){e.next=40;break}return N("Try No ".concat(h+1)),v={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n,deviceName:r,deviceId:a,lastMessageTimeStamp:c,latestLogId:s,accessToken:o,refreshToken:u})},j="",j="/login",e.next=14,fetch(j,v);case 14:return x=e.sent,console.log(typeof x),e.next=18,x.json();case 18:if(!(O=e.sent).error){e.next=29;break}return(k=S["".concat(O.error)])||(k=O.message),m=k,console.log("result errorMessage: ",k),e.next=26,y(5e3);case 26:return e.abrupt("continue",37);case 29:return f=O,e.next=32,C(O.chatList,O.email);case 32:return e.next=34,_(t,O.biggestChatLog);case 34:return e.next=36,K(O.loggedInUserId,O.chatList);case 36:return e.abrupt("break",40);case 37:h++,e.next=7;break;case 40:X(),f?i(f):(alert(m),l(m)),e.next=48;break;case 44:e.prev=44,e.t0=e.catch(0),console.error(e.t0),l(e.t0);case 48:case"end":return e.stop()}}),e,null,[[0,44]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=6,i;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),Q=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})},c="",c="/login/logout",e.next=6,fetch(c,a);case 6:return s=e.sent,e.t0=console,e.next=10,s.json();case 10:e.t1=e.sent,e.t2=typeof s,e.t0.log.call(e.t0,e.t1,e.t2),n(!0),e.next=19;break;case 16:e.prev=16,e.t3=e.catch(0),r(e.t3);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})},c="",c="/contact",e.next=5,fetch(c,a);case 5:return s=e.sent,e.next=8,s.json();case 8:(o=e.sent).error?(u=o.message,alert(u),r(u)):(i=o.data.chatList,n(i));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r){var a,c,s,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getState();case 2:if(a=e.sent,c=a.user,s=c.chatList,o=c.email,s[t]||s[n]){e.next=13;break}return e.next=9,Z(r);case 9:return u=e.sent,d.dispatch(Y(u)),e.next=13,C(s,o);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ee=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=d.getState(),a.user.chatList[t]?n(!0):n(!1);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=Object(k.a)(g.a.mark((function e(){var t,n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getState();case 2:return t=e.sent,n=t.user.email,e.next=6,Z(n);case 6:return r=e.sent,d.dispatch(Y(r)),e.next=10,C(r,n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=document.getElementById("messageContainer");e.scrollTop=e.scrollHeight},re=function(e){return x.b.error(e)},ae=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r,a){var c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(k.a)(g.a.mark((function e(c,s){var o,u,i,l,p,b,f,m,h,v,j,O,w,y;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||n){e.next=38;break}return o=JSON.parse(t),u=o.email,i=o.password,l=o.accessToken,p=o.refreshToken,b=localStorage.getItem(u),e.prev=3,V(),f=JSON.parse(b),m=f.deviceName,h=f.deviceId,e.next=8,H(u);case 8:return v=e.sent,e.next=11,P(u);case 11:return j=e.sent,e.next=14,z(u,i,m,h,v,j,l,p);case 14:O=e.sent,w="",w=window.location.origin.replace(/^http/,"ws"),(y=new WebSocket(w)).onopen=function(){console.log("Socket is open"),y.send(JSON.stringify({key:"setEmail",value:u})),r({type:"SET_WS",payload:y})},y.onmessage=function(){var e=Object(k.a)(g.a.mark((function e(t){var n,a,c,s,o,i,l,p,b,f,m,h,v,j,k,w,y,S;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=JSON.parse(t.data),"newMesssage"!==(a=n.key)){e.next=45;break}return c=n.text,s=n.sender,o=n.receiverUser,i=n.logId,l=n.sendAt,p=n.attachment,console.log("newMesssage: ",n),b=o.nickname,f=o.intId,m=s.nickname,h=s.intId,v={message:{attachment:p,text:c,received:!0,sendAt:l,logId:i},receiverUserName:b,senderName:m},e.next=11,$(m,b,u);case 11:return e.next=13,_(u,i);case 13:return e.next=15,d.getState();case 15:return j=e.sent,(k=j.currentFocus)===m||k===b?(r(J(v)),r(q(!1)),ne()):(g="New Message From ".concat(m," to ").concat(b),x.b.info(g)),e.next=20,te();case 20:return e.next=22,ee(m);case 22:if(!e.sent){e.next=30;break}return e.next=26,B(u,b,f,v,i);case 26:return e.next=28,D(O.loggedInUserId,f,v);case 28:e.next=43;break;case 30:if(h!==O.loggedInUserId){e.next=37;break}return e.next=33,B(u,b,f,v,i);case 33:return e.next=35,D(O.loggedInUserId,f,v);case 35:e.next=41;break;case 37:return e.next=39,B(u,m,h,v,i);case 39:return e.next=41,D(O.loggedInUserId,h,v);case 41:return e.next=43,F(u,l);case 43:e.next=46;break;case 45:"unreadMessages"===a&&(w=n.value,y=w.userId,S=w.messageStore,console.log(y,S));case 46:e.next=53;break;case 48:e.prev=48,e.t0=e.catch(0),console.log(e.t0),X(),console.log("We have a message: ",t.data);case 53:case"end":return e.stop()}var g}),e,null,[[0,48]])})));return function(t){return e.apply(this,arguments)}}(),y.onerror=function(){alert("Socket has error")},y.onclose=function(e){alert("Socket is closed"),console.log(e),a.push("/login")},r(R(O)),localStorage.setItem("token",JSON.stringify({accessToken:O.accessToken,refreshToken:O.accessToken,email:u,password:i})),X(),a.push("/"),c(!0),e.next=36;break;case 29:e.prev=29,e.t0=e.catch(3),X(),localStorage.removeItem("token"),a.push("/login"),console.error(e.t0),s(!0);case 36:e.next=40;break;case 38:console.log("Acoided +++++++++++++++++++"),c(!0);case 40:case"end":return e.stop()}}),e,null,[[3,29]])})));return function(t,n){return e.apply(this,arguments)}}());case 2:return c=e.sent,e.next=5,c;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),ce=n(2),se=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(f.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).loginFormHandler=function(){var t=Object(k.a)(g.a.mark((function t(n){var r,a,c,s,o,u,i;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.props,a=r.history,c=r.dispatch,n.preventDefault(),s=document.getElementById("userEmail"),o=s.value,u=document.getElementById("userPassword"),i=u.value,localStorage.getItem(o)){t.next=11;break}alert("Please register device first"),t.next=21;break;case 11:return t.prev=11,t.next=14,ae(JSON.stringify({email:o,password:i}),null,c,a);case 14:a.push("/"),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(11),console.error(t.t0),a.push("/login");case 21:case"end":return t.stop()}}),t,null,[[11,17]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(m.a)(n,[{key:"render",value:function(){return Object(ce.jsx)(ce.Fragment,{children:Object(ce.jsxs)("form",{className:"m-3",onSubmit:this.loginFormHandler,children:[Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"userEmail",className:"form-label",children:"Email address"}),Object(ce.jsx)("input",{type:"text",className:"form-control",id:"userEmail",required:!0,"aria-describedby":"emailHelp"}),Object(ce.jsx)("div",{id:"emailHelp",className:"form-text",children:"We'll never share your email with anyone else."})]}),Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"userPassword",className:"form-label",children:"Password"}),Object(ce.jsx)("input",{type:"password",className:"form-control",autoComplete:"true",required:!0,id:"userPassword"})]}),Object(ce.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:"Login"}),Object(ce.jsx)(j.b,{to:"/register",children:Object(ce.jsx)("button",{type:"submit",className:"btn btn-outline-info",children:"Register Device"})})]})})}}]),n}(a.a.Component),oe=Object(o.b)((function(e){return{chatList:e.user.chatList,currentFocus:e.currentFocus}}))(Object(w.g)(se)),ue=n(31),ie=n(286),le=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r,a){var c,s,o,u,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceName:t,deviceId:n,email:r,password:a})},s="",s="/device/sendCode",e.next=5,fetch(s,c);case 5:return o=e.sent,e.next=8,o.json();case 8:(u=e.sent).error?(i=u.message,alert(i),console.log("result: ",i)):(alert(u.message),console.log(u.message));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),pe=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(a,c){var s,o,u,i,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,email:n,password:r})},o="",o="/device/setCode",e.next=5,fetch(o,s);case 5:return u=e.sent,e.next=8,u.json();case 8:(i=e.sent).error?((l=S["".concat(i.error)])||(l=i.message),alert(l),console.log("result: ",i),console.log("errorMessage: ",l),c(l)):(a(i.message),alert(i.message));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,a;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),de=function(){var e=Object(w.f)(),t=Object(r.useState)(""),n=Object(ue.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(!1),o=Object(ue.a)(s,2),u=o[0],i=o[1],l=Object(r.useState)(!1),p=Object(ue.a)(l,2),d=p[0],b=p[1],f=function(){var e=Object(k.a)(g.a.mark((function e(t){var n,r,c,s,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=document.getElementById("userEmail"),r=n.value,c=document.getElementById("userPassword"),s=c.value,o=(o=Object(ie.a)()).split("-").join(""),console.log("deviceId: ",o),e.prev=8,i(!0),e.next=12,le(a,o,r,s);case 12:localStorage.setItem(r,JSON.stringify({deviceName:a,deviceId:o})),i(!1),console.log("deviceName: ",a),console.log("deviceId: ",o),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(8),console.error(e.t0),i(!1);case 22:case"end":return e.stop()}}),e,null,[[8,18]])})));return function(t){return e.apply(this,arguments)}}(),m=function(){var t=Object(k.a)(g.a.mark((function t(n){var r,a,c,s,o,u;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r=document.getElementById("userEmail"),a=r.value,c=document.getElementById("userPassword"),s=c.value,o=document.getElementById("registerCode"),u=o.value,t.prev=7,b(!0),t.next=11,pe(u,a,s);case 11:b(!1),e.push("/login"),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(7),console.error(t.t0),b(!1);case 19:case"end":return t.stop()}}),t,null,[[7,15]])})));return function(e){return t.apply(this,arguments)}}();return Object(ce.jsxs)("div",{children:[Object(ce.jsxs)("form",{className:"m-3",onSubmit:f,children:[Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"userEmail",className:"form-label",children:"Email address"}),Object(ce.jsx)("input",{type:"text",className:"form-control",id:"userEmail",required:!0,"aria-describedby":"emailHelp"}),Object(ce.jsx)("div",{id:"emailHelp",className:"form-text",children:"We'll never share your email with anyone else."})]}),Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"userPassword",className:"form-label",children:"Password"}),Object(ce.jsx)("input",{type:"password",className:"form-control",autoComplete:"true",required:!0,id:"userPassword"})]}),Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"machineName",className:"form-label",children:"Enter Device Name To Save"}),Object(ce.jsx)("input",{type:"text",className:"form-control",placeholder:"Office Pc",id:"machineName",onInput:function(e){return c(e.target.value)},required:!0})]}),Object(ce.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:u?Object(ce.jsx)("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}):"Send Code"}),Object(ce.jsx)(j.b,{to:"/login",children:Object(ce.jsx)("button",{type:"submit",className:"btn btn-outline-info",children:"Login"})})]}),Object(ce.jsxs)("form",{className:"m-3",onSubmit:m,children:[Object(ce.jsxs)("div",{className:"mb-3",children:[Object(ce.jsx)("label",{htmlFor:"registerCode",className:"form-label",children:"Enter code"}),Object(ce.jsx)("input",{type:"number",placeholder:"1234",className:"form-control",id:"registerCode",required:!0})]}),Object(ce.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:d?Object(ce.jsx)("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}):"Register"})]})]})},be=n.p+"static/media/profile.a9136072.png",fe=(n(279),function(e){var t=e.name,n=e.profileImage,r=e.onClickHandler,a=Object(o.d)((function(e){return e.currentFocus}));return Object(ce.jsx)("div",{className:"chatListItemContainer border rounded d-flex flex-row w-10 m-2 p-2 ".concat(a===t&&"focusedContact"),onClick:r,children:Object(ce.jsxs)("div",{children:[Object(ce.jsx)("img",{src:n||be,className:"rounded-circle profileWidth",alt:"profileImage"}),Object(ce.jsx)("h3",{className:"d-inline contactName",children:t})]})})}),me=n(147),he=n.n(me),ve=function(){var e=Object(k.a)(g.a.mark((function e(t){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=document.createElement("img")).src=t,(r=window.open("","_blank"))&&(r.document.title="AlivaKakaoClient",r.document.title="AlivaKakaoClient",r.document.body.appendChild(n),r.location.href=t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(e){return Object(ce.jsx)("img",{loading:"lazy",alt:"userImages",src:e.source,onClick:function(){return ve(e.url)},className:"hoverPointer p-1",width:"90",height:"90"})},xe=(n(280),function(){var e=Object(o.d)((function(e){var t=e.chat,n=e.currentFocus,r=e.chatLoading;t.sort((function(e,t){return e.sendAt-t.sendAt}));var a={},c={},s={};t.map((function(e){e.text.includes('{"feedType":14,"logId":')&&(c[e.text.substring(23,38)]="Deleted",s["".concat(e.logId).substring(0,15)]="DeletedIndicator");var t="".concat(e.logId).substring(0,15);a[t]=e}));var o=[];if(Object.keys(c).length>0)for(var u in a)if(Object.prototype.hasOwnProperty.call(a,u)){var i=a[u],l=c[u],p=s[u];if(l){var d=a[u];d.text="This message is deleted",d.attachment={},o.push(d);continue}p||o.push(i)}return{chat:o,currentFocus:n,chatLoading:r}})),t=e.chat,n=e.currentFocus,a=e.chatLoading;return Object(r.useEffect)((function(){console.log("chat: ",t),ne()}),[a,t]),Object(ce.jsxs)("div",{className:"m-2",id:"chatWindowContainer",children:[Object(ce.jsx)("h1",{children:"Chat Window"}),a&&"Loading.....",!a&&(null===t||void 0===t?void 0:t.length)>0&&t.map((function(e,t){var r,a,c,s,o,u;return Object(ce.jsx)("div",{className:"text-light p-1 w-100 d-flex flex-row ".concat(n===e.receiverUserName?"justify-content-end":"justify-content-start"),children:Object(ce.jsxs)("div",{className:"border border-dark rounded p-1 ".concat(n===e.receiverUserName?"receiverMessage":"senderMessage"),children:[e.attachment&&e.attachment.thumbnailUrl&&Object(ce.jsx)(je,{source:e.attachment.thumbnailUrl,url:e.attachment.url}),"voice note"===e.text&&Object(ce.jsx)("audio",{controls:!0,src:(null===e||void 0===e?void 0:e.audio)?e.audio:null===e||void 0===e?void 0:e.attachment.url}),"photo"!==e.text&&"voice note"!==e.text&&!(null===e||void 0===e||null===(r=e.attachment)||void 0===r?void 0:r.name)&&!(null===e||void 0===e||null===(a=e.attachment)||void 0===a?void 0:a.thumbnailUrls)&&(!(null===e||void 0===e?void 0:e.attachment)||!(null===(c=e.attachment)||void 0===c?void 0:c.thumbnailUrl))&&Object(ce.jsx)("span",{className:"m-1 text-wrap",children:e.text}),(null===e||void 0===e||null===(s=e.attachment)||void 0===s?void 0:s.name)&&Object(ce.jsx)("span",{className:"m-1 text-wrap",children:null===e||void 0===e||null===(o=e.attachment)||void 0===o?void 0:o.alt}),!(null===e||void 0===e?void 0:e.thumbnails)&&(null===e||void 0===e||null===(u=e.attachment)||void 0===u?void 0:u.thumbnailUrls)&&e.attachment.thumbnailUrls.map((function(t,n){return Object(ce.jsx)(je,{source:t,url:e.attachment.imageUrls[n]},n)})),(null===e||void 0===e?void 0:e.thumbnails)&&e.thumbnails.map((function(t,n){return Object(ce.jsx)(je,{source:t,url:e.attachment.imageUrls[n]},n)})),Object(ce.jsx)("span",{className:"small bg-secondary makeItLight rounded p-1",children:he()(e.sendAt).format("hh:mm:ss A DD/MM/YYYY")})]})},t)}))]})}),Oe=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(n,r){var a,c,s,o,u,i,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=d.getState(),!(c=a.user.accessToken)){e.next=17;break}return console.log("accessToken: ",c),(s=new FormData).append("myFile",t),o={method:"POST",body:s},u="",u="/uploadfile",e.next=11,fetch(u,o);case 11:return i=e.sent,e.next=14,i.json();case 14:l=e.sent,console.log("result: ",l),n(l);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),r(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=(n(281),function(){var e=Object(r.useState)({name:""}),t=Object(ue.a)(e,2),n=t[0],a=t[1],c=Object(o.d)((function(e){return e.currentFocus})),s=Object(o.d)((function(e){return e.user.email})),u=Object(o.d)((function(e){return e.user.chatList})),i=Object(o.d)((function(e){return e.isSending})),l=Object(o.d)((function(e){return e.ws})),p=Object(o.c)(),d=Object(r.useState)(""),b=Object(ue.a)(d,2),f=b[0],m=b[1],h=function(){var e=Object(k.a)(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.clipboardData.files.length?(r=t.clipboardData.files[0],a(r),console.log(n)):alert("No image data was found in your clipboard. Copy an image first or take a screenshot.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(k.a)(g.a.mark((function e(){var t,r,o,i,d,b,h,v,j,x;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=document.getElementById("userFileUpload"),c){e.next=5;break}return alert("Please a contact first"),e.abrupt("return");case 5:if(f||!(t.files.length<=0)||n){e.next=8;break}return alert("Plase select a file or type some message"),e.abrupt("return");case 8:if(p(q(!0)),!(t.files.length>0||n.name)){e.next=37;break}if(!n.name){e.next=20;break}return e.next=13,Oe(n);case 13:r=e.sent,o=r.path,i=u[c].channelId,l&&l.send(JSON.stringify({key:"newMessageFile",value:{message:f,receiver:c,filePath:o,email:s,channelId:i}})),a({name:""}),e.next=33;break;case 20:e.t0=g.a.keys(t.files);case 21:if((e.t1=e.t0()).done){e.next=33;break}if(d=e.t1.value,!Object.prototype.hasOwnProperty.call(t.files,d)){e.next=31;break}return b=t.files[d],e.next=27,Oe(b);case 27:h=e.sent,v=h.path,j=u[c].channelId,l&&l.send(JSON.stringify({key:"newMessageFile",value:{message:f,receiver:c,filePath:v,email:s,channelId:j}}));case 31:e.next=21;break;case 33:t.value="",a({name:""}),e.next=40;break;case 37:x=u[c].intId,l.send(JSON.stringify({key:"newMessage",value:{message:f,receiver:c,email:s,receiverIntId:x}})),m("");case 40:p(q(!1)),e.next=48;break;case 43:e.prev=43,e.t2=e.catch(0),console.error(e.t2),re("Error in sending message"),p(q(!1));case 48:case"end":return e.stop()}}),e,null,[[0,43]])})));return function(){return e.apply(this,arguments)}}();return Object(ce.jsxs)("div",{className:"messageInputContainer",children:[Object(ce.jsxs)("span",{className:"m-2",children:["Selected file"," ",Object(ce.jsx)("span",{className:"text-danger",children:n.name})]}),Object(ce.jsxs)("form",{className:"m-2",onSubmit:function(e){e.preventDefault(),v()},encType:"multipart/form-data",children:[Object(ce.jsx)("div",{children:Object(ce.jsx)("input",{type:"text",autoFocus:!0,className:"form-control",onInput:function(e){var t=e.target;m(t.value)},value:f,onPaste:h})}),Object(ce.jsx)("div",{className:"form-group mt-2",children:Object(ce.jsx)("input",{type:"file",className:"form-control-file",id:"userFileUpload",accept:"image/*"})}),Object(ce.jsx)("button",{disabled:!!i,className:"btn btn-outline-light mt-2",type:"submit",children:i?Object(ce.jsx)("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}):"Send"})]})]})}),ke=function(){return Object(ce.jsxs)("div",{children:[Object(ce.jsx)(xe,{}),Object(ce.jsx)(ge,{})]})},we=n(91),ye=function(){var e=Object(k.a)(g.a.mark((function e(t,n,r,a,c){var s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Promise(function(){var e=Object(k.a)(g.a.mark((function e(s,o){var u,i,l,p,d,b,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,nickNameToGetChat:n,lastMessageTimeStamp:r,lastChatLogId:a,startChatLogId:c})},i="",i="/chat",e.next=5,fetch(i,u);case 5:return l=e.sent,e.next=8,l.json();case 8:(p=e.sent).error?(d=p.message,alert(d),console.log("result: ",p),console.log("errorMessage: ",d),o(d)):(b=p.data,f=b.userId,m=b.messages,s({userId:f,messages:m}),console.log(p));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,s;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),Se=function(){var e=Object(k.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise((function(e,n){try{var r=new FileReader;r.onload=function(t){t.target&&e(t.target.result)},r.readAsText(t)}catch(a){n(a)}})),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ne=function(){var e=Object(k.a)(g.a.mark((function e(t){var n,r,a,c,s,o,u,i,l,p,b,f,m,h,v,j;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.getState();case 3:return r=e.sent,a=r.loggedInUserId,c=r.user,s=d.dispatch,e.next=9,P(c.email);case 9:return o=e.sent,u=null===(n=c.chatList[t])||void 0===n?void 0:n.intId,s({type:"SET_FOCUSED_USER",payload:t}),e.next=14,M(a,u);case 14:return i=e.sent,l=i.allMessages,p=i.lastMessageTimeStamp,b=i.logId,e.next=20,ye(c.email,t,p,o,b);case 20:return f=e.sent,m=f.messages,h=[].concat(Object(we.a)(m),Object(we.a)(l)),v=h.map(function(){var e=Object(k.a)(g.a.mark((function e(t){var n,r,a,c,s,o,u,i,l,p,d,b,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("photo"===t.text||"\uc0ac\uc9c4"===t.text&&(null===(n=t.attachment)||void 0===n?void 0:n.thumbnailUrl))){e.next=13;break}return e.next=3,G(t.attachment.thumbnailKey||"");case 3:if(!(c=e.sent)){e.next=11;break}return e.next=7,Se(c);case 7:s=e.sent,t.thumbnail="data:".concat(t.attachment.mt,";base64,").concat(s),console.log("imgBlob: ",c),console.log("base64: ",t.thumbnail);case 11:e.next=42;break;case 13:if(!(null===t||void 0===t||null===(r=t.attachment)||void 0===r?void 0:r.thumbnailUrls)){e.next=32;break}t.thumbnails=[],o=0;case 16:if(!(o<(null===t||void 0===t?void 0:t.attachment.thumbnailUrls.length))){e.next=30;break}return u=null===t||void 0===t?void 0:t.attachment.thumbnailUrls[o],i=Object(I.SHA256)(u).toString(),e.next=21,G(i);case 21:if(!(l=e.sent)){e.next=27;break}return e.next=25,Se(l);case 25:p=e.sent,t.attachment.mtl&&t.thumbnails.push("data:".concat(t.attachment.mtl[o],";base64,").concat(p));case 27:o++,e.next=16;break;case 30:e.next=42;break;case 32:if("voice note"!==t.text||!(null===(a=t.attachment)||void 0===a?void 0:a.url)){e.next=42;break}return b=Object(I.SHA256)(null===(d=t.attachment)||void 0===d?void 0:d.url).toString(),e.next=36,G(b);case 36:if(!(f=e.sent)){e.next=42;break}return e.next=40,Se(f);case 40:m=e.sent,t.audio="data:audio/mpeg;base64,".concat(m);case 42:return e.abrupt("return",t);case 43:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=26,Promise.all(v);case 26:return j=e.sent,s(W(j)),e.next=30,U(j,a,u);case 30:ne(),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(0),console.error(e.t0);case 36:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}(),Ie=(n(282),Object(o.b)((function(e){return{user:e.user,loggedInUserId:e.loggedInUserId,ws:e.ws}}))((function(e){var t=Object(o.c)(),n=function(){var e=Object(k.a)(g.a.mark((function e(n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"START_CHAT_LOADING",payload:null}),e.next=3,Ne(n);case 3:return e.next=5,te();case 5:t({type:"STOP_CHAT_LOADING",payload:null});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ce.jsxs)("div",{className:"d-flex rounded",id:"homeMainContainer",children:[Object(ce.jsx)("div",{className:"chatListContainer border rounded d-flex flex-column flex-wrap m-2 justify-content-center",children:e.user.chatList?function(){var t=[],r=0,a=e.user.chatList;for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&function(){var e=a[c];t.push(Object(ce.jsx)(fe,{profileImage:e.displayUserList[0].profileURL,name:e.displayUserList[0].nickname,onClickHandler:function(){return n(e.displayUserList[0].nickname)}},r)),r++}();return t}():""}),Object(ce.jsx)("div",{className:"border m-2 rounded",id:"messageContainer",children:Object(ce.jsx)(ke,{})})]})}))),Te=function(e){var t=e.email,n=Object(o.d)((function(e){return e.ws})),r=Object(o.c)(),a=Object(w.f)(),c=function(){var e=Object(k.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(),e.next=3,Q(t);case 3:r({type:"LOGOUT"}),localStorage.removeItem("token"),a.push("/login"),n.close(),X();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ce.jsxs)(ce.Fragment,{children:[Object(ce.jsx)("li",{className:"nav-item",children:Object(ce.jsx)("span",{className:"nav-link active",children:t})}),Object(ce.jsx)("li",{className:"nav-item hoverEffect",onClick:c,children:Object(ce.jsx)("span",{className:"nav-link active",children:"Logout"})})]})},Ae=function(){return Object(ce.jsx)(ce.Fragment,{children:Object(ce.jsx)("li",{className:"nav-item",children:Object(ce.jsx)(j.b,{className:"nav-link active",to:"/login",children:"Login"})})})},Ee=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=Object(k.a)(g.a.mark((function e(){var t,n,r,a,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("token"),n=this.props,r=n.dispatch,a=n.history,c=n.token,e.prev=2,!t){e.next=6;break}return e.next=6,ae(t,c,r,a);case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.token,n=e.email;return Object(ce.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark",children:Object(ce.jsxs)("div",{className:"container-fluid",children:[Object(ce.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#alivaNavbar","aria-controls":"alivaNavbar","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(ce.jsx)("span",{className:"navbar-toggler-icon"})}),Object(ce.jsxs)("div",{className:"collapse navbar-collapse",id:"alivaNavbar",children:[Object(ce.jsx)(j.b,{className:"navbar-brand",to:"/",children:"AlivaTech"}),Object(ce.jsx)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:t?Object(ce.jsx)(Te,{email:n}):Object(ce.jsx)(Ae,{})})]})]})})}}]),n}(a.a.Component),Le=Object(o.b)((function(e){return{token:e.user.accessToken,email:e.user.email}}))(Object(w.g)(Ee)),Ce=n(63),_e=function(e){var t=e.component,n=(e.token,Object(Ce.a)(e,["component","token"]));return Object(ce.jsx)(w.b,Object(i.a)(Object(i.a)({},n),{},{render:function(e){return Object(ce.jsx)(t,Object(i.a)({},e))}}))},Pe=Object(o.b)((function(e){return{token:e.user.accessToken,loading:e.loading}}))((function(e){var t=e.component,n=e.token,r=e.loading,a=Object(Ce.a)(e,["component","token","loading"]);return Object(ce.jsx)(w.b,Object(i.a)(Object(i.a)({},a),{},{render:function(e){return console.log("token: ",n),n||r?Object(ce.jsx)(t,Object(i.a)({},e)):Object(ce.jsx)(w.a,{to:{pathname:"/login"}})}}))})),Ue=n(148),De=n.n(Ue),Me=(n(283),function(){return Object(ce.jsxs)("div",{className:"loadingContainer",children:[Object(ce.jsx)(De.a,{className:"setMarginLoading",type:"spin",color:"white",height:"2%",width:"2%"}),Object(ce.jsx)("h1",{className:"m-3",children:"Loading....."}),Object(ce.jsx)("br",{}),Object(ce.jsx)("h2",{id:"loginTryMessage",children:""})]})}),Fe=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this.props.loading;return Object(ce.jsx)(ce.Fragment,{children:Object(ce.jsxs)(j.a,{children:[Object(ce.jsx)(x.a,{}),Object(ce.jsx)(Le,{}),e?Object(ce.jsx)(Me,{}):Object(ce.jsxs)(ce.Fragment,{children:[Object(ce.jsx)(Pe,{exact:!0,path:"/",component:Ie}),Object(ce.jsx)(_e,{exact:!0,path:"/login",component:oe}),Object(ce.jsx)(_e,{exact:!0,path:"/register",component:de})]})]})})}}]),n}(a.a.Component),He=Object(o.b)((function(e){return{loading:e.loading}}))(Fe);s.a.render(Object(ce.jsx)(a.a.StrictMode,{children:Object(ce.jsx)(o.a,{store:d,children:Object(ce.jsx)(He,{})})}),document.getElementById("root")),b()}},[[284,1,2]]]);
//# sourceMappingURL=main.1583aaed.chunk.js.map