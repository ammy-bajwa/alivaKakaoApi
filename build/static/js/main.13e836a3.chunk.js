(this["webpackJsonpaliva-kakao-client-ts"]=this["webpackJsonpaliva-kakao-client-ts"]||[]).push([[0],{156:function(e,t,n){},163:function(e,t){},165:function(e,t){},175:function(e,t){},177:function(e,t){},204:function(e,t){},205:function(e,t){},210:function(e,t){},212:function(e,t){},219:function(e,t){},238:function(e,t){},279:function(e,t,n){},280:function(e,t,n){},281:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},284:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(40),s=n.n(c),o=n(10),i=(n(156),n(157),n(92)),u=n(31),l=n(6),d={user:{email:"",chatList:{},accessToken:""},loggedInUserId:"",chat:[],currentFocus:"",ws:null,loading:!1},p=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.a,m=Object(i.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return console.log(t),e=Object(l.a)(Object(l.a)({},e),{},{user:{email:t.payload.email,chatList:t.payload.chatList,accessToken:t.payload.accessToken},loggedInUserId:t.payload.loggedInUserId,chat:[]});case"LOGOUT":return e=Object(l.a)(Object(l.a)({},e),{},{user:{email:"",chatList:{},accessToken:""}});case"LOAD_CHAT":return e=Object(l.a)(Object(l.a)({},e),{},{chat:t.payload});case"START_LOADING":return e=Object(l.a)(Object(l.a)({},e),{},{loading:!0});case"STOP_LOADING":return e=Object(l.a)(Object(l.a)({},e),{},{loading:!1});case"SET_FOCUSED_USER":return e=Object(l.a)(Object(l.a)({},e),{},{currentFocus:t.payload});case"SET_WS":return e=Object(l.a)(Object(l.a)({},e),{},{ws:t.payload});case"SET_CONTACT_LIST":return e=Object(l.a)(Object(l.a)({},e),{},{user:Object(l.a)(Object(l.a)({},e.user),{},{chatList:t.payload})});case"NEW_MESSAGE":var n=t.payload,r=n.receiverUserName,a=n.message,c=n.senderName;return e=Object(l.a)(Object(l.a)({},e),{},{chat:[].concat(Object(u.a)(e.chat),[Object(l.a)(Object(l.a)({receiverUserName:r},a),{},{senderName:c})])});default:return e}}),p()),b=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,287)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))},f=n(42),j=n(43),h=n(45),O=n(44),g=n(21),v=n(9),x=n(46),y=n(2),k=n.n(y),N=n(4),w={12:"LOGIN_FAILED_REASON",13:"TOO_MANY_TRY_LOGIN",30:"LOGIN_FAILED",32:"MOBILE_UNREGISTERED","-100":"DEVICE_NOT_REGISTERED","-101":"ANOTHER_LOGON","-102":"DEVICE_REGISTER_FAILED","-110":"INVALID_DEVICE_REGISTER","-111":"INCORRECT_PASSCODE","-112":"PASSCODE_REQUEST_FAILED","-997":"ACCOUNT_RESTRICTED"},S=n(30),I=n(24),T=function(){var e=Object(N.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(r,a){var c,s,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=Object(S.SHA256)("KAKAOCONTACTS".concat(n)).toString(),s="ContactStore",o="contacts",e.next=6,Object(I.b)(c,1,{upgrade:function(e){e.createObjectStore(s)}});case 6:return i=e.sent,e.next=9,i.put(s,t,o);case 9:i.close(),r(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),a(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(e){return{type:"LOGIN",payload:e}},C=function(e){return{type:"SET_FOCUSED_USER",payload:e}},A=function(e){return{type:"SET_WS",payload:e}},L=function(e){return{type:"NEW_MESSAGE",payload:e}},F=function(e){return{type:"LOAD_CHAT",payload:e}},U=function(e){return{type:"SET_CONTACT_LIST",payload:e}},_=function(){m.dispatch({type:"START_LOADING"})},P=function(){m.dispatch({type:"STOP_LOADING"})},D=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r,a){var c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(c,s){var o,i,u,l,d,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=m.getState(),i=o.user.accessToken,console.log("accessToken: ",i),i){e.next=27;break}return _(),u={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n,deviceName:r,deviceId:a})},l="",l="/login",e.next=10,fetch(l,u);case 10:return d=e.sent,e.next=13,d.json();case 13:if(d=e.sent,P(),!d.error){e.next=23;break}(p=w["".concat(d.error)])||(p=d.message),alert(p),console.log("result errorMessage: ",p),s(p),e.next=27;break;case 23:return console.log("result: ",d),e.next=26,T(d.chatList,d.loggedInUserId);case 26:c(d);case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(0),s(e.t0);case 32:case"end":return e.stop()}}),e,null,[[0,29]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,c;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),M=function(){var e=Object(N.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(n,r){var a,c,s,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})},c="",c="/contact",e.next=6,fetch(c,a);case 6:return s=e.sent,e.next=9,s.json();case 9:s=e.sent,P(),s.error?(o=s.message,alert(o),console.log("result: ",s),console.log("errorMessage: ",o),r(o)):(i=s.data.chatList,n(i),console.log(s));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r){var a,c,s,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.getState();case 2:if(a=e.sent,c=a.user,s=a.loggedInUserId,c[t]&&c[n]){e.next=12;break}return e.next=8,M(r);case 8:return o=e.sent,m.dispatch(U(o)),e.next=12,T(c,s);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),H=function(){var e=document.getElementById("messageContainer");e.scrollTop=e.scrollHeight},G=function(e){return x.b.success(e)},J=function(e){return x.b.info(e)},B=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(a,c){var s,o,i,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=Object(S.SHA256)("KAKAOCHAT".concat(r).concat(n)).toString(),o="MessageStore",i="messages",e.next=6,Object(I.b)(s,1,{upgrade:function(e){e.createObjectStore(o)}});case 6:return u=e.sent,e.next=9,u.put(o,t,i);case 9:u.close(),a(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),c(e.t0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,a;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),W=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r){var a,c,s,o,i,u,d,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(S.SHA256)("KAKAOCHAT".concat(n).concat(t)).toString(),c="MessageStore",s="messages",o=!1,e.next=6,Object(I.b)(a,1,{upgrade:function(e){o=!0}});case 6:if(i=e.sent,!o){e.next=14;break}return i.close(),e.next=11,Object(I.a)(a);case 11:return e.abrupt("return");case 14:return u=Object(l.a)({receiverUserName:r.receiverUserName,senderName:r.senderName},r.message),e.next=17,i.get(c,s);case 17:return d=e.sent,p=d.concat([u]),e.next=21,i.put(c,p,s);case 21:return i.close(),e.abrupt("return",d);case 23:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),K=function(){var e=Object(N.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(r,a){var c,s,o,i,u,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=Object(S.SHA256)("KAKAOCHAT".concat(n).concat(t)).toString(),s="MessageStore",o="messages",i=!1,e.next=7,Object(I.b)(c,1,{upgrade:function(e){i=!0}});case 7:if(u=e.sent,!i){e.next=15;break}return r({allMessages:[],lastMessageTimeStamp:0,logId:0}),u.close(),e.next=13,Object(I.a)(c);case 13:e.next=19;break;case 15:return e.next=17,u.get(s,o);case 17:l=e.sent,r({allMessages:l||[],lastMessageTimeStamp:l[l.length-1].sendAt||0,logId:l[l.length-1].logId||0});case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),a(e.t0),console.error(e.t0);case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,r;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=n(1),Y=function(e){Object(h.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(f.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).loginFormHandler=function(){var t=Object(N.a)(k.a.mark((function t(n){var r,a,c,s,o,i,u,l,d,p,b,f,j,h;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.props,a=r.history,c=r.dispatch,n.preventDefault(),s=document.getElementById("userEmail"),o=s.value,i=document.getElementById("userPassword"),u=i.value,l=localStorage.getItem(o)){t.next=11;break}alert("Please register device first"),t.next=36;break;case 11:return t.prev=11,_(),d=JSON.parse(l),p=d.deviceName,b=d.deviceId,t.next=16,D(o,u,p,b);case 16:f=t.sent,console.log("user: ",f),j="",j=window.location.origin.replace(/^http/,"ws"),(h=new WebSocket(j)).onopen=function(){console.log("Socket is open"),h.send(JSON.stringify({key:"setEmail",value:o})),c(A(h))},h.onmessage=function(){var e=Object(N.a)(k.a.mark((function e(t){var n,r,a,s,i,u,l,d,p,b,j,h,O,g,v;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=JSON.parse(t.data),"newMesssage"!==(r=n.key)){e.next=20;break}return a=n.text,s=n.sender,i=n.receiverUser,u=n.sendAt,l=n.attachment,d=Object.keys(i)[0],p=s.nickname,b={receiverUserName:d,message:{attachment:l,text:a,received:!0,sendAt:u},senderName:p},e.next=10,m.getState();case 10:return j=e.sent,h=j.currentFocus,console.log("currentFocus: ",h),e.next=15,R(p,d,o);case 15:return h===p||h===d?(c(L(b)),H()):J("New Message From ".concat(p," to ").concat(d)),e.next=18,W(f.loggedInUserId,i[d].userId.low,b);case 18:e.next=21;break;case 20:"unreadMessages"===r&&(O=n.value,g=O.userId,v=O.messageStore,console.log(g,v));case 21:e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),P(),console.log("We have a message: ",t.data);case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}(),h.onerror=function(){alert("Socket has error")},h.onclose=function(){alert("Socket is closed"),c({type:"LOGOUT"}),a.push("/login")},c(E(f)),localStorage.setItem("token",JSON.stringify({accessToken:f.accessToken,refreshToken:f.accessToken,email:o,password:u})),a.push("/"),P(),t.next=36;break;case 31:t.prev=31,t.t0=t.catch(11),P(),localStorage.removeItem("token"),console.error(t.t0);case 36:case"end":return t.stop()}}),t,null,[[11,31]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(j.a)(n,[{key:"render",value:function(){return Object(q.jsx)(q.Fragment,{children:Object(q.jsxs)("form",{className:"m-3",onSubmit:this.loginFormHandler,children:[Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"userEmail",className:"form-label",children:"Email address"}),Object(q.jsx)("input",{type:"email",className:"form-control",id:"userEmail",required:!0,"aria-describedby":"emailHelp"}),Object(q.jsx)("div",{id:"emailHelp",className:"form-text",children:"We'll never share your email with anyone else."})]}),Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"userPassword",className:"form-label",children:"Password"}),Object(q.jsx)("input",{type:"password",className:"form-control",autoComplete:"true",required:!0,id:"userPassword"})]}),Object(q.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:"Login"}),Object(q.jsx)(g.b,{to:"/register",children:Object(q.jsx)("button",{type:"submit",className:"btn btn-outline-info",children:"Register Device"})})]})})}}]),n}(a.a.Component),V=Object(o.b)((function(e){return{chatList:e.user.chatList,currentFocus:e.currentFocus}}))(Object(v.h)(Y)),X=n(286),z=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r,a){var c,s,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceName:t,deviceId:n,email:r,password:a})},s="",s="/device/sendCode",e.next=6,fetch(s,c);case 6:return o=e.sent,e.next=9,o.json();case 9:o=e.sent,P(),o.error?(i=o.message,alert(i),console.log("result: ",i)):(alert(o.message),console.log(o.message));case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Q=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(a,c){var s,o,i,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,email:n,password:r})},o="",o="/device/setCode",e.next=6,fetch(o,s);case 6:return i=e.sent,e.next=9,i.json();case 9:i=e.sent,P(),i.error?((u=w["".concat(i.error)])||(u=i.message),alert(u),console.log("result: ",i),console.log("errorMessage: ",u),c(u)):(a(i.message),alert(i.message),console.log(i));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,a;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Z=function(){var e=Object(v.g)(),t=function(){var e=Object(N.a)(k.a.mark((function e(t){var n,r,a,c,s,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=document.getElementById("userEmail"),r=n.value,a=document.getElementById("userPassword"),c=a.value,s=document.getElementById("machineName"),o=s.value,i=(i=Object(X.a)()).split("-").join(""),console.log("deviceId: ",i),e.prev=10,e.next=13,z(o,i,r,c);case 13:localStorage.setItem(r,JSON.stringify({deviceName:o,deviceId:i})),console.log("deviceName: ",o),console.log("deviceId: ",i),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),console.error(e.t0);case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}(),n=function(){var t=Object(N.a)(k.a.mark((function t(n){var r,a,c,s,o,i;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r=document.getElementById("userEmail"),a=r.value,c=document.getElementById("userPassword"),s=c.value,o=document.getElementById("registerCode"),i=o.value,t.prev=7,t.next=10,Q(i,a,s);case 10:e.push("/login"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(7),console.error(t.t0);case 16:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e){return t.apply(this,arguments)}}();return Object(q.jsxs)("div",{children:[Object(q.jsxs)("form",{className:"m-3",onSubmit:t,children:[Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"userEmail",className:"form-label",children:"Email address"}),Object(q.jsx)("input",{type:"email",className:"form-control",id:"userEmail",required:!0,"aria-describedby":"emailHelp"}),Object(q.jsx)("div",{id:"emailHelp",className:"form-text",children:"We'll never share your email with anyone else."})]}),Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"userPassword",className:"form-label",children:"Password"}),Object(q.jsx)("input",{type:"password",className:"form-control",autoComplete:"true",required:!0,id:"userPassword"})]}),Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"machineName",className:"form-label",children:"Enter Device Name To Save"}),Object(q.jsx)("input",{type:"text",className:"form-control",placeholder:"Office Pc",id:"machineName",required:!0})]}),Object(q.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:"Send Code"}),Object(q.jsx)(g.b,{to:"/login",children:Object(q.jsx)("button",{type:"submit",className:"btn btn-outline-info",children:"Login"})})]}),Object(q.jsxs)("form",{className:"m-3",onSubmit:n,children:[Object(q.jsxs)("div",{className:"mb-3",children:[Object(q.jsx)("label",{htmlFor:"registerCode",className:"form-label",children:"Enter code"}),Object(q.jsx)("input",{type:"number",placeholder:"1234",className:"form-control",id:"registerCode",required:!0})]}),Object(q.jsx)("button",{type:"submit",className:"btn btn-outline-light m-2",children:"Register"})]})]})},$=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r,a,c){var s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(s,o){var i,u,l,d,p,m,b;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,nickNameToGetChat:n,lastMessageTimeStamp:r,lastChatLogId:a,startChatLogId:c})},u="",u="/chat",e.next=6,fetch(u,i);case 6:return l=e.sent,e.next=9,l.json();case 9:l=e.sent,P(),l.error?(d=l.message,alert(d),console.log("result: ",l),console.log("errorMessage: ",d),o(d)):(p=l.data,m=p.userId,b=p.messages,s({userId:m,messages:b}),console.log(l));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,s;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),ee=n.p+"static/media/profile.a9136072.png",te=(n(279),function(e){var t=e.name,n=e.profileImage,r=e.onClickHandler,a=Object(o.d)((function(e){return e.currentFocus}));return Object(q.jsxs)("div",{className:"chatListItemContainer border rounded d-flex flex-row w-10 m-2 p-2 ".concat(a===t&&"focusedContact"),onClick:r,children:[Object(q.jsx)("img",{src:n||ee,className:"rounded-circle profileWidth",alt:"profileImage"}),Object(q.jsx)("h3",{className:"d-inline contactName",children:t})]})}),ne=n(91),re=n.n(ne),ae=function(){var e=Object(N.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise((function(e,n){try{var r=new FileReader;r.onload=function(t){console.log(t.target.result),e(t.target.result)},r.readAsDataURL(t)}catch(a){n(a)}})),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=(n(280),function(e){var t=Object(o.d)((function(e){var t=e.chat,n=e.currentFocus;return t.sort((function(e,t){return e.sendAt-t.sendAt})),t.forEach(function(){var e=Object(N.a)(k.a.mark((function e(t){var n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("photo"!==t.text||!t.attachment||!t.attachment.thumbnailUrl){e.next=12;break}return console.log("messageObj: ",t),e.next=4,fetch(t.attachment.thumbnailUrl,{mode:"no-cors"});case 4:return n=e.sent,e.next=7,n.blob();case 7:return r=e.sent,e.next=10,ae(r);case 10:a=e.sent,console.log("result64: ",a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{chat:t,currentFocus:n}})),n=t.chat,r=t.currentFocus;return Object(q.jsxs)("div",{className:"m-2",id:"chatWindowContainer",children:[console.log("props: ",e),Object(q.jsx)("h1",{children:"Chat Window"}),n.length>0?n.map((function(e,t){return Object(q.jsxs)("div",{className:e.received?"d-flex border-bottom m-2 text-light":"d-flex flex-row-reverse text-light",children:["photo"===e.text&&e.attachment&&e.attachment.thumbnailUrl&&Object(q.jsx)("img",{loading:"lazy",alt:"userImages",src:e.attachment.thumbnailUrl,onClick:function(){return window.open(e.attachment.url,"_blank")},className:"hoverPointer",width:"90",height:"90"}),Object(q.jsxs)("span",{className:"m-2 p-2 d-block w-100 rounded ".concat(r===e.receiverUserName?"receiverMessage border border-light":"senderMessage border border-dark"),children:[e.text,Object(q.jsx)("hr",{}),Object(q.jsxs)("span",{className:"w-100 d-flex justify-content-between",children:[Object(q.jsx)("span",{children:re()(e.sendAt).format("hh:mm:ss A")}),Object(q.jsx)("span",{children:re()(e.sendAt).format("DD/MM/YYYY")})]})]})]},t)})):"Message Will Be Here"]})}),se=n(148),oe=function(){var e=Object(N.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(){var e=Object(N.a)(k.a.mark((function e(n,r){var a,c,s,o,i,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=m.getState(),!(c=a.user.accessToken)){e.next=19;break}return console.log("accessToken: ",c),(s=new FormData).append("myFile",t),_(),o={method:"POST",body:s},i="",i="/uploadfile",e.next=12,fetch(i,o);case 12:return u=e.sent,e.next=15,u.json();case 15:u=e.sent,console.log("result: ",u),P(),n(u);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),P(),r(e.t0);case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=(n(281),function(){var e=Object(o.d)((function(e){return e.currentFocus})),t=Object(o.d)((function(e){return e.user.email})),n=Object(o.d)((function(e){return e.user.chatList})),a=Object(o.d)((function(e){return e.ws})),c=Object(o.c)(),s=Object(r.useState)(""),i=Object(se.a)(s,2),u=i[0],l=i[1],d=function(){var r=Object(N.a)(k.a.mark((function r(s){var o,i,d,p,m,b,f,j,h,O;return k.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,s.preventDefault(),o=(new Date).getTime(),i=document.getElementById("userFileUpload"),e){r.next=7;break}return alert("Please a contact first"),r.abrupt("return");case 7:if(u||!(i.files.length<=0)){r.next=10;break}return alert("Plase select a file or type some message"),r.abrupt("return");case 10:if(!(i.files.length>0)){r.next=31;break}r.t0=k.a.keys(i.files);case 12:if((r.t1=r.t0()).done){r.next=29;break}if(d=r.t1.value,!Object.prototype.hasOwnProperty.call(i.files,d)){r.next=27;break}return p=i.files[d],r.next=18,ae(p);case 18:return m=r.sent,console.log(m),r.next=22,oe(p);case 22:b=r.sent,f=b.path,j=n[e].channelId,a.send(JSON.stringify({key:"newMessageFile",value:{message:u,receiver:e,filePath:f,email:t,channelId:j}})),c(L({receiverUserName:e,message:{text:"photo",received:!0,attachment:{thumbnailUrl:m},sendAt:o},senderName:"Self"}));case 27:r.next=12;break;case 29:r.next=39;break;case 31:console.log(e),h=n[e].channelId,a.send(JSON.stringify({key:"newMessage",value:{message:u,receiver:e,email:t,channelId:h}})),c(L({receiverUserName:e,message:{text:u,received:!0,sendAt:o},senderName:"Self"})),l(""),(O=document.getElementById("chatWindowContainer")).scrollTop=O.scrollHeight,console.log("Fired");case 39:G("Sended Successfully"),H(),r.next=47;break;case 43:r.prev=43,r.t2=r.catch(0),console.error(w),w("Error in sending message");case 47:case"end":return r.stop()}}),r,null,[[0,43]])})));return function(e){return r.apply(this,arguments)}}();return Object(q.jsx)("div",{className:"messageInputContainer",children:Object(q.jsxs)("form",{className:"m-2",onSubmit:d,encType:"multipart/form-data",children:[Object(q.jsx)("div",{children:Object(q.jsx)("input",{type:"text",className:"form-control",onInput:function(e){return l(e.target.value)},value:u})}),Object(q.jsx)("div",{className:"form-group mt-2",children:Object(q.jsx)("input",{type:"file",className:"form-control-file",id:"userFileUpload"})}),Object(q.jsx)("button",{className:"btn btn-outline-light mt-2",type:"submit",children:"Send"})]})})}),ue=function(){return Object(q.jsxs)("div",{children:[Object(q.jsx)(ce,{}),Object(q.jsx)(ie,{})]})},le=(n(282),Object(o.b)((function(e){return{user:e.user,loggedInUserId:e.loggedInUserId,ws:e.ws}}))((function(e){var t=function(){var t=Object(N.a)(k.a.mark((function t(n,r){var a,c,s,o,i,l,d,p,m,b,f;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c=e.dispatch,s=e.loggedInUserId,o=e.user,i=null===(a=o.chatList[n])||void 0===a?void 0:a.lastChatLogId,c(C(n)),t.next=6,K(s,r);case 6:return l=t.sent,d=l.allMessages,p=l.lastMessageTimeStamp,m=l.logId,console.log("Fired"),console.log(p),t.next=14,$(o.email,n,p,i,m);case 14:return b=t.sent,f=b.messages,c(F([].concat(Object(u.a)(d),Object(u.a)(f)))),t.next=19,B([].concat(Object(u.a)(d),Object(u.a)(f)),s,r);case 19:H(),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),console.error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[0,22]])})));return function(e,n){return t.apply(this,arguments)}}();return Object(q.jsxs)("div",{className:"d-flex rounded",id:"homeMainContainer",children:[Object(q.jsx)("div",{className:"chatListContainer border rounded d-flex flex-column flex-wrap m-2 justify-content-center",children:e.user.chatList?function(){var n=[],r=0,a=e.user.chatList;for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&function(){var e=a[c];n.push(Object(q.jsx)(te,{profileImage:e.displayUserList[0].profileURL,name:e.displayUserList[0].nickname,onClickHandler:function(){return t(e.displayUserList[0].nickname,e.intId)}},r)),r++}();return n}():""}),Object(q.jsx)("div",{className:"border m-2 rounded",id:"messageContainer",children:Object(q.jsx)(ue,{})})]})}))),de=function(e){var t=e.email,n=Object(o.c)(),r=Object(v.g)();return Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)("li",{className:"nav-item",children:Object(q.jsx)(g.b,{className:"nav-link active","aria-current":"page",to:"/",children:"Home"})}),Object(q.jsx)("li",{className:"nav-item",children:Object(q.jsx)("span",{className:"nav-link active",children:t})}),Object(q.jsx)("li",{className:"nav-item hoverEffect",onClick:function(){n({type:"LOGOUT"}),localStorage.removeItem("token"),r.push("/login")},children:Object(q.jsx)("span",{className:"nav-link active",children:"Logout"})})]})},pe=function(){return Object(q.jsx)(q.Fragment,{children:Object(q.jsx)("li",{className:"nav-item",children:Object(q.jsx)(g.b,{className:"nav-link active",to:"/login",children:"Login"})})})},me=function(){var e=Object(N.a)(k.a.mark((function e(t,n,r,a){var c,s,o,i,u,l,d,p,b,f;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||n){e.next=30;break}return c=JSON.parse(t),s=c.email,o=c.password,i=localStorage.getItem(s),e.prev=3,_(),u=JSON.parse(i),l=u.deviceName,d=u.deviceId,e.next=8,D(s,o,l,d);case 8:p=e.sent,b="",b=window.location.origin.replace(/^http/,"ws"),(f=new WebSocket(b)).onopen=function(){console.log("Socket is open"),f.send(JSON.stringify({key:"setEmail",value:s})),r(A(f))},f.onmessage=function(){var e=Object(N.a)(k.a.mark((function e(t){var n,a,c,o,i,u,l,d,b,f,j,h,O,g,v;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=JSON.parse(t.data),"newMesssage"!==(a=n.key)){e.next=20;break}return c=n.text,o=n.sender,i=n.receiverUser,u=n.sendAt,l=n.attachment,d=Object.keys(i)[0],b=o.nickname,f={receiverUserName:d,message:{attachment:l,text:c,received:!0,sendAt:u},senderName:b},e.next=10,m.getState();case 10:return j=e.sent,h=j.currentFocus,console.log("currentFocus: ",h),e.next=15,R(b,d,s);case 15:return h===b||h===d?(r(L(f)),H()):J("New Message From ".concat(b," to ").concat(d)),e.next=18,W(p.loggedInUserId,i[d].userId.low,f);case 18:e.next=21;break;case 20:"unreadMessages"===a&&(O=n.value,g=O.userId,v=O.messageStore,console.log(g,v));case 21:e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),P(),console.log("We have a message: ",t.data);case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}(),f.onerror=function(){alert("Socket has error")},f.onclose=function(e){alert("Socket is closed"),console.log(e),a.push("/login")},r(E(p)),localStorage.setItem("token",JSON.stringify({accessToken:p.accessToken,refreshToken:p.accessToken,email:s,password:o})),a.push("/"),P(),e.next=28;break;case 22:e.prev=22,e.t0=e.catch(3),P(),localStorage.removeItem("token"),a.push("/login"),console.error(e.t0);case 28:e.next=31;break;case 30:console.log("Acoided +++++++++++++++++++");case 31:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),be=function(e){Object(h.a)(n,e);var t=Object(O.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"componentDidMount",value:function(){var e=Object(N.a)(k.a.mark((function e(){var t,n,r,a,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=localStorage.getItem("token"),n=this.props,r=n.dispatch,a=n.history,c=n.token,e.next=4,me(t,c,r,a);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.token,n=e.email;return Object(q.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark",children:Object(q.jsxs)("div",{className:"container-fluid",children:[Object(q.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#alivaNavbar","aria-controls":"alivaNavbar","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(q.jsx)("span",{className:"navbar-toggler-icon"})}),Object(q.jsxs)("div",{className:"collapse navbar-collapse",id:"alivaNavbar",children:[Object(q.jsx)(g.b,{className:"navbar-brand",to:"/",children:"AlivaTech"}),Object(q.jsx)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:t?Object(q.jsx)(de,{email:n}):Object(q.jsx)(pe,{})})]})]})})}}]),n}(a.a.Component),fe=Object(o.b)((function(e){return{token:e.user.accessToken,email:e.user.email}}))(Object(v.h)(be)),je=n(63),he=function(e){var t=e.component,n=(e.token,Object(je.a)(e,["component","token"]));return Object(q.jsx)(v.b,Object(l.a)(Object(l.a)({},n),{},{render:function(e){return Object(q.jsx)(t,Object(l.a)({},e))}}))},Oe=Object(o.b)((function(e){return{token:e.user.accessToken}}))((function(e){var t=e.component,n=e.token,r=Object(je.a)(e,["component","token"]);return Object(q.jsx)(v.b,Object(l.a)(Object(l.a)({},r),{},{render:function(e){return n?Object(q.jsx)(t,Object(l.a)({},e)):Object(q.jsx)(v.a,{to:{pathname:"/login"}})}}))})),ge=n(147),ve=n.n(ge),xe=(n(283),function(){return Object(q.jsxs)("div",{className:"loadingContainer",children:[Object(q.jsx)(ve.a,{className:"setMarginLoading",type:"spin",color:"white",height:"2%",width:"2%"}),Object(q.jsx)("h1",{className:"m-3",children:"Loading....."})]})}),ye=function(e){Object(h.a)(n,e);var t=Object(O.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return this.props.loading?Object(q.jsx)(q.Fragment,{children:Object(q.jsx)(xe,{})}):Object(q.jsx)("div",{children:Object(q.jsxs)(g.a,{children:[Object(q.jsx)(x.a,{}),Object(q.jsx)(fe,{}),Object(q.jsxs)(v.d,{children:[Object(q.jsx)(he,{path:"/login",component:V}),Object(q.jsx)(he,{path:"/register",component:Z}),Object(q.jsx)(Oe,{path:"/",component:le})]})]})})}}]),n}(a.a.Component),ke=Object(o.b)((function(e){return{loading:e.loading}}))(ye);s.a.render(Object(q.jsx)(a.a.StrictMode,{children:Object(q.jsx)(o.a,{store:m,children:Object(q.jsx)(ke,{})})}),document.getElementById("root")),b()}},[[284,1,2]]]);
//# sourceMappingURL=main.13e836a3.chunk.js.map