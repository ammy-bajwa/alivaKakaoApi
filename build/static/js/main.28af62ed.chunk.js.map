{"version":3,"sources":["redux/reducer/user.ts","redux/index.ts","reportWebVitals.ts","helpers/delay.ts","helpers/errorCodes.ts","helpers/loading.ts","idb/contacts.ts","idb/messages.ts","redux/action/user.ts","utils/loading.ts","api/user.ts","api/contact.ts","helpers/contact.ts","helpers/scroll.ts","helpers/toast.ts","helpers/loginHandler.ts","pages/login/login.tsx","api/device.ts","pages/registerDevice/registerDevice.tsx","assets/images/profile.png","components/chatListItem/chatListItem.tsx","components/chatWindow/chatWindow.tsx","api/file.ts","components/messageInput/messageInput.tsx","components/messages/messages.tsx","api/chat.ts","helpers/file.ts","helpers/messages.ts","pages/home/home.tsx","components/navbar/privateNavItems/privateNavItems.tsx","components/navbar/publicNavItems/publicNavItems.tsx","components/navbar/navbar.tsx","routes/public/public.tsx","routes/private/private.tsx","components/loading/loading.tsx","routes/index.tsx","index.tsx"],"names":["initialState","user","email","chatList","accessToken","loggedInUserId","chat","currentFocus","ws","loading","isSending","chatLoading","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","state","action","type","console","log","payload","receiverUserName","message","senderName","concat","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","causeDelay","time","a","myTaskPromise","Promise","resolve","reject","setTimeout","errors","setLoginLoadingMessage","loginTryMessage","document","getElementById","innerText","handleContacts","contacts","contactsHandlerPromise","dbName","SHA256","toString","storeName","openDB","upgrade","db","createObjectStore","messageDb","key","Object","prototype","hasOwnProperty","call","element","put","intId","messages","forEach","displayUserList","nickname","logId","text","attachment","thumbnailUrlBase64","urlBase64","thumbnailKey","thumbnailUrl","urlKey","url","myImgDb","get","isThumbnailAlreadyExists","isurlAlreadyExists","Blob","mt","close","error","updateContactLogid","newLogId","getLatestContactLogid","value","handleIncommingMessages","otherUserId","messageHandlerPromise","addNewMessageIdb","newMessage","dbNotExists","newValue","data","lastDbMessageTime","getLastMessagePromise","allMessages","lastMessageTimeStamp","deleteDB","length","sendAt","updatedLastMessageTimeStamp","latestTimeStamp","updatedTimePromise","getLastMessageTimeStamp","timeStamp","updateUserMessages","newMessages","dbItemKey","updateMessageLogs","userName","userId","getImgBlobFromIdb","myWorkingTask","loginUser","loadChat","setContactList","contactList","setSending","sending","startLoading","dispatch","stopLoading","tryLoginApi","password","deviceName","deviceId","latestLogId","myAccessToken","myRefreshToken","loginPromise","getState","index","requestOptions","method","headers","body","JSON","stringify","refreshToken","apiEndPoint","fetch","result","json","errorMessage","loginErrorMessage","loginResult","biggestChatLog","largestTimeStamp","alert","logoutUserNodejs","myWorkingPromise","getChatList","setCodePromise","handleContactList","loggedInUserEmail","isInContact","name","isInContactPromise","refreshContactList","scrollToEndMessages","messageElement","scrollTop","scrollHeight","toast","loginHandler","isKeepLogin","token","history","parse","deviceData","localStorage","getItem","wsEndPoint","location","origin","replace","socket","WebSocket","onopen","send","onmessage","event","sender","receiverUser","receiverIntId","senderIntId","newMessageObj","received","info","messageStore","onerror","onclose","err","push","setItem","removeItem","Login","loginFormHandler","props","preventDefault","emailElem","passwordElem","className","onSubmit","this","htmlFor","id","required","aria-describedby","autoComplete","to","React","Component","connect","withRouter","trySendDeviceRegisterApi","trySetDeviceRegisterApi","code","RegisterDevice","useHistory","useState","setDeviceName","isLoadingSend","setLoadingSend","isLoadingRegister","setLoadingRegister","registerFormHandler","randomId","split","join","registerCodeFormHandler","registerCodeElem","registerCode","placeholder","onInput","target","role","aria-hidden","ChatListItem","profileImage","onClickHandler","newChatCount","useSelector","onClick","src","profile","alt","ChatWindow","sort","b","imageOnClickHandler","image","createElement","w","open","title","appendChild","href","useEffect","map","thumbnail","width","height","controls","moment","format","uploadFile","file","fileUploadPromise","FormData","append","MessageInput","currentSelectedFile","setSelectedFile","useDispatch","setMessage","handlePaste","e","clipboardData","files","fileObject","sendMessageHandler","userFileUpload","path","channelId","receiver","filePath","selectedFile","encType","autoFocus","onPaste","accept","disabled","Messages","getUserChat","nickNameToGetChat","lastChatLogId","startChatLogId","readBlobText","blob","base64Promise","reader","FileReader","onload","readAsText","refreshMessages","focusedName","focusedUserId","messagesToSet","imgPromisesChat","imgBlob","base64","all","items","item","profileURL","getChatListItems","PrivateNavItems","logOutHandler","aria-current","PublicNavItems","Navbar","data-bs-toggle","data-bs-target","aria-controls","aria-expanded","aria-label","Public","component","rest","render","pathname","Loading","color","MainRouter","exact","Home","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.28af62ed.chunk.js","sourcesContent":["const initialState = {\r\n  user: {\r\n    email: \"\",\r\n    chatList: {},\r\n    accessToken: \"\",\r\n  },\r\n  loggedInUserId: \"\",\r\n  chat: [],\r\n  currentFocus: \"\",\r\n  ws: null,\r\n  loading: false,\r\n  isSending: false,\r\n  chatLoading: false,\r\n};\r\n\r\nexport const userReducer = function (state: any = initialState, action: any) {\r\n  switch (action.type) {\r\n    case \"LOGIN\":\r\n      console.log(action);\r\n      state = {\r\n        ...state,\r\n        user: {\r\n          email: action.payload.email,\r\n          chatList: action.payload.chatList,\r\n          accessToken: action.payload.accessToken,\r\n        },\r\n        loggedInUserId: action.payload.loggedInUserId,\r\n        chat: [],\r\n      };\r\n      return state;\r\n    case \"LOGOUT\":\r\n      state = {\r\n        ...state,\r\n        user: {\r\n          email: \"\",\r\n          chatList: {},\r\n          accessToken: \"\",\r\n        },\r\n      };\r\n      return state;\r\n    case \"LOAD_CHAT\":\r\n      state = { ...state, chat: action.payload };\r\n      return state;\r\n    case \"START_LOADING\":\r\n      state = { ...state, loading: true };\r\n      return state;\r\n    case \"STOP_LOADING\":\r\n      state = { ...state, loading: false };\r\n      return state;\r\n    case \"START_CHAT_LOADING\":\r\n      state = { ...state, chatLoading: true };\r\n      return state;\r\n    case \"STOP_CHAT_LOADING\":\r\n      state = { ...state, chatLoading: false };\r\n      return state;\r\n    case \"SET_FOCUSED_USER\":\r\n      state = { ...state, currentFocus: action.payload };\r\n      return state;\r\n    case \"SET_WS\":\r\n      state = { ...state, ws: action.payload };\r\n      return state;\r\n    case \"SET_CONTACT_LIST\":\r\n      state = { ...state, user: { ...state.user, chatList: action.payload } };\r\n      return state;\r\n    case \"SET_SENDING\":\r\n      state = { ...state, isSending: action.payload };\r\n      return state;\r\n    case \"NEW_MESSAGE\":\r\n      const { receiverUserName, message, senderName } = action.payload;\r\n      state = {\r\n        ...state,\r\n        chat: state.chat.concat([{ receiverUserName, ...message, senderName }]),\r\n      };\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { compose, createStore } from \"redux\";\r\nimport { userReducer } from \"./reducer/user\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __REDUX_DEVTOOLS_EXTENSION_COMPOSE__?: typeof compose;\r\n  }\r\n}\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\nexport const store = createStore(userReducer, composeEnhancers());\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","export const causeDelay = async (time: number) => {\r\n  const myTaskPromise = new Promise((resolve, reject) => {\r\n    setTimeout(() => {\r\n      resolve(true);\r\n    }, time);\r\n  });\r\n\r\n  return await myTaskPromise;\r\n};\r\n","export const errors: any = {\r\n  \"12\": \"LOGIN_FAILED_REASON\",\r\n  \"13\": \"TOO_MANY_TRY_LOGIN\",\r\n  \"30\": \"LOGIN_FAILED\",\r\n  \"32\": \"MOBILE_UNREGISTERED\",\r\n  \"-100\": \"DEVICE_NOT_REGISTERED\",\r\n  \"-101\": \"ANOTHER_LOGON\",\r\n  \"-102\": \"DEVICE_REGISTER_FAILED\",\r\n  \"-110\": \"INVALID_DEVICE_REGISTER\",\r\n  \"-111\": \"INCORRECT_PASSCODE\",\r\n  \"-112\": \"PASSCODE_REQUEST_FAILED\",\r\n  \"-997\": \"ACCOUNT_RESTRICTED\",\r\n};\r\n","export const setLoginLoadingMessage = (message: string) => {\r\n  const loginTryMessage = document.getElementById(\"loginTryMessage\");\r\n  if (loginTryMessage) {\r\n    loginTryMessage.innerText = message;\r\n  }\r\n};\r\n","import { SHA256 } from \"crypto-js\";\r\nimport { deleteDB, openDB } from \"idb\";\r\n\r\nexport const handleContacts = async (contacts: any, email: number) => {\r\n  const contactsHandlerPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOCONTACTS${email}`).toString();\r\n      const storeName = \"ContactStore\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      const messageDb = await openDB(`${email}_message_logs`, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(\"myLogsData\");\r\n        },\r\n      });\r\n      for (const key in contacts) {\r\n        if (Object.prototype.hasOwnProperty.call(contacts, key)) {\r\n          const element = contacts[key];\r\n          await db.put(storeName, element, element.intId);\r\n          element.messages.forEach(async (message: any) => {\r\n            const key = `${element.displayUserList[0].nickname}__${element.intId}__${message.logId}`;\r\n            if (\r\n              (message?.text === \"photo\" || message?.text === \"사진\") &&\r\n              message?.attachment &&\r\n              message?.attachment?.thumbnailUrlBase64 &&\r\n              message?.attachment?.urlBase64\r\n            ) {\r\n              // open the db and check if data already exists\r\n              const dbName = SHA256(\"KakaoUserImages\").toString();\r\n              const storeName = \"imgStore\";\r\n              const thumbnailKey = SHA256(\r\n                message.attachment.thumbnailUrl\r\n              ).toString();\r\n              message.attachment.thumbnailKey = thumbnailKey;\r\n              const urlKey = SHA256(message.attachment.url).toString();\r\n              message.attachment.urlKey = urlKey;\r\n              const myImgDb = await openDB(dbName, 1, {\r\n                async upgrade(myImgDb) {\r\n                  myImgDb.createObjectStore(storeName);\r\n                },\r\n              });\r\n              const isThumbnailAlreadyExists = await myImgDb.get(\r\n                storeName,\r\n                thumbnailKey\r\n              );\r\n              const isurlAlreadyExists = await myImgDb.get(storeName, urlKey);\r\n              if (!isThumbnailAlreadyExists) {\r\n                console.log(\"Img message: \", message);\r\n                await myImgDb.put(\r\n                  storeName,\r\n                  new Blob([message.attachment.thumbnailUrlBase64], {\r\n                    type: message.attachment.mt,\r\n                  }),\r\n                  thumbnailKey\r\n                );\r\n              }\r\n              if (!isurlAlreadyExists) {\r\n                await myImgDb.put(\r\n                  storeName,\r\n                  new Blob([message.attachment.urlBase64], {\r\n                    type: message.attachment.mt,\r\n                  }),\r\n                  urlKey\r\n                );\r\n              }\r\n              myImgDb.close();\r\n            }\r\n            await messageDb.put(\"myLogsData\", message, key);\r\n          });\r\n        }\r\n      }\r\n      db.close();\r\n      setTimeout(() => {\r\n        messageDb.close();\r\n      }, 1000);\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await contactsHandlerPromise;\r\n};\r\n\r\nexport const getContactListLogs = async (email: number) => {\r\n  const myTaskPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOCONTACTS${email}`).toString();\r\n      const storeName = \"ContactStore\";\r\n      let isExists = true;\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n          isExists = false;\r\n        },\r\n      });\r\n      if (!isExists) {\r\n        db.close();\r\n        await deleteDB(dbName);\r\n        resolve([]);\r\n      } else {\r\n        const storeKeys = await db.getAllKeys(storeName);\r\n        let contactList: any = {};\r\n        storeKeys.forEach(async (element) => {\r\n          const { lastChatLogId } = await db.get(storeName, element);\r\n          contactList[lastChatLogId] = { lastChatLogId };\r\n        });\r\n        db.close();\r\n        resolve(contactList);\r\n      }\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await myTaskPromise;\r\n};\r\n\r\nexport const updateContactLogid = async (email: string, newLogId: number) => {\r\n  const myTaskPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOLOGID${email}`).toString();\r\n      const storeName = \"logs\";\r\n      const key = \"logId\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      await db.put(storeName, newLogId, key);\r\n      db.close();\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await myTaskPromise;\r\n};\r\n\r\nexport const getLatestContactLogid = async (email: any) => {\r\n  const myTaskPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOLOGID${email}`).toString();\r\n      const storeName = \"logs\";\r\n      const key = \"logId\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      const value = (await db.get(storeName, key)) || 0;\r\n      db.close();\r\n      resolve(value);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await myTaskPromise;\r\n};\r\n","import { SHA256 } from \"crypto-js\";\r\n\r\nimport { deleteDB, openDB } from \"idb\";\r\n\r\nexport const handleIncommingMessages = async (\r\n  messages: any,\r\n  loggedInUserId: number,\r\n  otherUserId: number\r\n) => {\r\n  const messageHandlerPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(\r\n        `KAKAOCHAT${loggedInUserId}${otherUserId}`\r\n      ).toString();\r\n      const storeName = \"MessageStore\";\r\n      const key = \"messages\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      await db.put(storeName, messages, key);\r\n      db.close();\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await messageHandlerPromise;\r\n};\r\n\r\nexport const getUserMessages = async (\r\n  loggedInUserId: number,\r\n  otherUserId: number\r\n) => {\r\n  const dbName = SHA256(`KAKAOCHAT${loggedInUserId}${otherUserId}`).toString();\r\n  const storeName = \"MessageStore\";\r\n  const key = \"messages\";\r\n  let dbNotExists = false;\r\n  const db = await openDB(dbName, 1, {\r\n    upgrade(db) {\r\n      dbNotExists = true;\r\n    },\r\n  });\r\n\r\n  if (dbNotExists) {\r\n    db.close();\r\n    await deleteDB(dbName);\r\n    return;\r\n  } else {\r\n    const data = await db.get(storeName, key);\r\n    db.close();\r\n    return data;\r\n  }\r\n};\r\n\r\nexport const addNewMessageIdb = async (\r\n  loggedInUserId: number,\r\n  otherUserId: number,\r\n  newMessage: any\r\n) => {\r\n  const dbName = SHA256(`KAKAOCHAT${loggedInUserId}${otherUserId}`).toString();\r\n  const storeName = \"MessageStore\";\r\n  const key = \"messages\";\r\n  let dbNotExists = false;\r\n  const db = await openDB(dbName, 1, {\r\n    upgrade(db) {\r\n      dbNotExists = true;\r\n      db.createObjectStore(storeName);\r\n    },\r\n  });\r\n  const newValue = {\r\n    receiverUserName: newMessage.receiverUserName,\r\n    senderName: newMessage.senderName,\r\n    ...newMessage.message,\r\n  };\r\n  if (dbNotExists) {\r\n    await db.put(storeName, [newValue], key);\r\n    db.close();\r\n    return;\r\n  } else {\r\n    const data = await db.get(storeName, key);\r\n    const value = data.concat([newValue]);\r\n    await db.put(storeName, value, key);\r\n    db.close();\r\n    return data;\r\n  }\r\n};\r\n\r\nexport const lastDbMessageTime = async (\r\n  loggedInUserId: number,\r\n  otherUserId: number\r\n) => {\r\n  const getLastMessagePromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(\r\n        `KAKAOCHAT${loggedInUserId}${otherUserId}`\r\n      ).toString();\r\n      const storeName = \"MessageStore\";\r\n      const key = \"messages\";\r\n      let dbNotExists = false;\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          dbNotExists = true;\r\n        },\r\n      });\r\n      if (dbNotExists) {\r\n        resolve({\r\n          allMessages: [],\r\n          lastMessageTimeStamp: 0,\r\n          logId: 0,\r\n        });\r\n        db.close();\r\n        await deleteDB(dbName);\r\n      } else {\r\n        const data = await db.get(storeName, key);\r\n        resolve({\r\n          allMessages: data || [],\r\n          lastMessageTimeStamp: data[data.length - 1].sendAt || 0,\r\n          logId: data[data.length - 1].logId || 0,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n  return await getLastMessagePromise;\r\n};\r\n\r\nexport const updatedLastMessageTimeStamp = async (\r\n  email: string,\r\n  latestTimeStamp: number\r\n) => {\r\n  const updatedTimePromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOTIMESTAMP${email}`).toString();\r\n      const storeName = \"time\";\r\n      const key = \"timeStamp\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      await db.put(storeName, latestTimeStamp, key);\r\n      db.close();\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await updatedTimePromise;\r\n};\r\n\r\nexport const getLastMessageTimeStamp = async (email: string) => {\r\n  const updatedTimePromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(`KAKAOTIMESTAMP${email}`).toString();\r\n      const storeName = \"time\";\r\n      const key = \"timeStamp\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      const timeStamp = (await db.get(storeName, key)) || 0;\r\n      db.close();\r\n      resolve(timeStamp);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await updatedTimePromise;\r\n};\r\n\r\nexport const updateUserMessages = async (\r\n  loggedInUserId: number,\r\n  newMessages: any\r\n) => {\r\n  const myTaskPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      for (const key in newMessages) {\r\n        if (Object.prototype.hasOwnProperty.call(newMessages, key)) {\r\n          const { intId, messages } = newMessages[key];\r\n          const dbName = SHA256(\r\n            `KAKAOCHAT${loggedInUserId}${intId}`\r\n          ).toString();\r\n          const storeName = \"MessageStore\";\r\n          const dbItemKey = \"messages\";\r\n          let dbNotExists = false;\r\n          const db = await openDB(dbName, 1, {\r\n            upgrade(db) {\r\n              dbNotExists = true;\r\n              db.createObjectStore(storeName);\r\n            },\r\n          });\r\n          if (dbNotExists) {\r\n            await db.put(storeName, messages, dbItemKey);\r\n            db.close();\r\n          } else {\r\n            const data = await db.get(storeName, dbItemKey);\r\n            const value = data.concat(messages);\r\n            await db.put(storeName, value, dbItemKey);\r\n            db.close();\r\n          }\r\n        }\r\n      }\r\n      resolve(true);\r\n    } catch (error) {\r\n      console.error(error);\r\n      reject(error);\r\n    }\r\n  });\r\n  return await myTaskPromise;\r\n};\r\n\r\nexport const updateMessageLogs = async (\r\n  email: string,\r\n  userName: string,\r\n  userId: number,\r\n  message: any,\r\n  logId: number\r\n) => {\r\n  const updatedTimePromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = `${email}_message_logs`;\r\n      const storeName = \"myLogsData\";\r\n      const key = `${userName}__${userId}__${logId}`;\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      await db.put(storeName, message, key);\r\n      db.close();\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await updatedTimePromise;\r\n};\r\n\r\nexport const getImgBlobFromIdb = async (key: string) => {\r\n  const myWorkingTask = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const dbName = SHA256(\"KakaoUserImages\").toString();\r\n      const storeName = \"imgStore\";\r\n      const db = await openDB(dbName, 1, {\r\n        upgrade(db) {\r\n          db.createObjectStore(storeName);\r\n        },\r\n      });\r\n      const value = await db.get(storeName, key);\r\n      resolve(value);\r\n      db.close();\r\n    } catch (error) {\r\n      reject(error);\r\n      console.error(error);\r\n    }\r\n  });\r\n\r\n  return await myWorkingTask;\r\n};\r\n","export const loginUser = (user: any) => ({\r\n  type: \"LOGIN\",\r\n  payload: user,\r\n});\r\n\r\nexport const logoutUser = () => ({\r\n  type: \"LOGOUT\",\r\n});\r\n\r\nexport const setFocusUser = (name: string) => ({\r\n  type: \"SET_FOCUSED_USER\",\r\n  payload: name,\r\n});\r\n\r\nexport const setWs = (ws: any) => ({\r\n  type: \"SET_WS\",\r\n  payload: ws,\r\n});\r\n\r\nexport const newMessage = (data: any) => {\r\n  return {\r\n    type: \"NEW_MESSAGE\",\r\n    payload: data,\r\n  };\r\n};\r\n\r\nexport const loadChat = (messages: any) => ({\r\n  type: \"LOAD_CHAT\",\r\n  payload: messages,\r\n});\r\n\r\nexport const setStartLoading = () => ({\r\n  type: \"START_LOADING\",\r\n});\r\n\r\nexport const setStopLoading = () => ({\r\n  type: \"STOP_LOADING\",\r\n});\r\n\r\nexport const setStartChatLoading = () => ({\r\n  type: \"START_CHAT_LOADING\",\r\n});\r\n\r\nexport const setStopChatLoading = () => ({\r\n  type: \"STOP_CHAT_LOADING\",\r\n});\r\n\r\nexport const setContactList = (contactList: any) => ({\r\n  type: \"SET_CONTACT_LIST\",\r\n  payload: contactList,\r\n});\r\n\r\nexport const setSending = (sending: boolean) => ({\r\n  type: \"SET_SENDING\",\r\n  payload: sending,\r\n});\r\n","import { store } from \"../redux\";\r\n\r\nimport { setStartLoading, setStopLoading } from \"../redux/action/user\";\r\n\r\nexport const startLoading = () => {\r\n  store.dispatch(setStartLoading());\r\n};\r\n\r\nexport const stopLoading = () => {\r\n  store.dispatch(setStopLoading());\r\n};\r\n","import { port } from \"../helpers/config\";\r\nimport { causeDelay } from \"../helpers/delay\";\r\nimport { errors } from \"../helpers/errorCodes\";\r\nimport { setLoginLoadingMessage } from \"../helpers/loading\";\r\nimport { handleContacts, updateContactLogid } from \"../idb/contacts\";\r\nimport {\r\n  updatedLastMessageTimeStamp,\r\n  updateUserMessages,\r\n} from \"../idb/messages\";\r\nimport { store } from \"../redux\";\r\nimport { startLoading, stopLoading } from \"../utils/loading\";\r\n\r\nexport const tryLoginApi = async (\r\n  email: string,\r\n  password: string,\r\n  deviceName: string,\r\n  deviceId: string,\r\n  lastMessageTimeStamp: any,\r\n  latestLogId: any,\r\n  myAccessToken: string = \"\",\r\n  myRefreshToken: string = \"\"\r\n) => {\r\n  const loginPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const {\r\n        user: { accessToken },\r\n      } = store.getState();\r\n      console.log(\"accessToken: \", accessToken);\r\n      let loginResult, loginErrorMessage;\r\n      if (!accessToken) {\r\n        startLoading();\r\n        for (let index = 0; index < 15; index++) {\r\n          setLoginLoadingMessage(`Try No ${index + 1}`);\r\n          const requestOptions = {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n              email,\r\n              password,\r\n              deviceName,\r\n              deviceId,\r\n              lastMessageTimeStamp,\r\n              latestLogId,\r\n              accessToken: myAccessToken,\r\n              refreshToken: myRefreshToken,\r\n            }),\r\n          };\r\n          let apiEndPoint = \"\";\r\n          if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n            // dev code\r\n            apiEndPoint = `http://localhost:${port}/login`;\r\n          } else {\r\n            // production code\r\n            apiEndPoint = \"/login\";\r\n          }\r\n          let result: any = await fetch(apiEndPoint, requestOptions);\r\n          result = await result.json();\r\n          if (result.error) {\r\n            let errorMessage = errors[`${result.error}`];\r\n            if (!errorMessage) {\r\n              errorMessage = result.message;\r\n            }\r\n            loginErrorMessage = errorMessage;\r\n            console.log(\"result errorMessage: \", errorMessage);\r\n            await causeDelay(5000);\r\n            continue;\r\n          } else {\r\n            loginResult = result;\r\n            await handleContacts(result.chatList, result.email);\r\n            await updateUserMessages(result.loggedInUserId, result.chatList);\r\n            await updateContactLogid(email, result.biggestChatLog);\r\n            console.log(\"result: \", result);\r\n            await updatedLastMessageTimeStamp(\r\n              result.email,\r\n              result.largestTimeStamp\r\n            );\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      stopLoading();\r\n      if (loginResult) {\r\n        resolve(loginResult);\r\n      } else {\r\n        alert(loginErrorMessage);\r\n        reject(loginErrorMessage);\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      reject(error);\r\n    }\r\n  });\r\n  return await loginPromise;\r\n};\r\n\r\nexport const logoutUserNodejs = async (email: string) => {\r\n  const myWorkingPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const requestOptions = {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          email,\r\n        }),\r\n      };\r\n      let apiEndPoint = \"\";\r\n      if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n        // dev code\r\n        apiEndPoint = `http://localhost:${port}/login/logout`;\r\n      } else {\r\n        // production code\r\n        apiEndPoint = \"/login/logout\";\r\n      }\r\n      let result: any = await fetch(apiEndPoint, requestOptions);\r\n      console.log(await result.json());\r\n      resolve(true);\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  });\r\n  return await myWorkingPromise;\r\n};\r\n","import { port } from \"../helpers/config\";\r\n\r\nexport const getChatList = async (email: string) => {\r\n  const setCodePromise = new Promise(async (resolve, reject) => {\r\n    // startLoading();\r\n    const requestOptions = {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ email }),\r\n    };\r\n    let apiEndPoint = \"\";\r\n    if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n      // dev code\r\n      apiEndPoint = `http://localhost:${port}/contact`;\r\n    } else {\r\n      // production code\r\n      apiEndPoint = \"/contact\";\r\n    }\r\n    let result: any = await fetch(apiEndPoint, requestOptions);\r\n    result = await result.json();\r\n    // stopLoading();\r\n    if (result.error) {\r\n      let errorMessage = result.message;\r\n      alert(errorMessage);\r\n      console.log(\"result: \", result);\r\n      console.log(\"errorMessage: \", errorMessage);\r\n      reject(errorMessage);\r\n    } else {\r\n      const { chatList } = result.data;\r\n      resolve(chatList);\r\n      console.log(result);\r\n    }\r\n  });\r\n\r\n  return await setCodePromise;\r\n};\r\n","import { getChatList } from \"../api/contact\";\r\nimport { handleContacts } from \"../idb/contacts\";\r\nimport { store } from \"../redux\";\r\nimport { setContactList } from \"../redux/action/user\";\r\n\r\nexport const handleContactList = async (\r\n  senderName: string,\r\n  receiverUserName: string,\r\n  loggedInUserEmail: string\r\n) => {\r\n  const {\r\n    user: { chatList, email },\r\n  } = await store.getState();\r\n  if (!chatList[senderName] && !chatList[receiverUserName]) {\r\n    const contactList = await getChatList(loggedInUserEmail);\r\n    store.dispatch(setContactList(contactList));\r\n    await handleContacts(chatList, email);\r\n  }\r\n};\r\n\r\nexport const isInContact = async (name: any) => {\r\n  const isInContactPromise = new Promise(async (resolve, reject) => {\r\n    const { user: chatList } = await store.getState();\r\n    if (!chatList[name]) {\r\n      resolve(false);\r\n    } else {\r\n      resolve(true);\r\n    }\r\n  });\r\n  return await isInContactPromise;\r\n};\r\n\r\nexport const refreshContactList = async () => {\r\n  const {\r\n    user: { email },\r\n  } = await store.getState();\r\n  const contactList = await getChatList(email);\r\n  store.dispatch(setContactList(contactList));\r\n  await handleContacts(contactList, email);\r\n};\r\n","export const scrollToEndMessages = () => {\r\n  const messageElement = document.getElementById(\r\n    \"messageContainer\"\r\n  ) as HTMLElement;\r\n  messageElement.scrollTop = messageElement.scrollHeight;\r\n};\r\n","import { toast } from \"react-toastify\";\r\n\r\nexport const success = (message: string) => toast.success(message);\r\n\r\nexport const info = (message: string) => toast.info(message);\r\n\r\nexport const error = (message: string) => toast.error(message);\r\n","import { tryLoginApi } from \"../api/user\";\r\nimport { getLatestContactLogid, updateContactLogid } from \"../idb/contacts\";\r\nimport {\r\n  addNewMessageIdb,\r\n  getLastMessageTimeStamp,\r\n  updatedLastMessageTimeStamp,\r\n  updateMessageLogs,\r\n} from \"../idb/messages\";\r\nimport { store } from \"../redux\";\r\nimport { loginUser, newMessage, setSending, setWs } from \"../redux/action/user\";\r\nimport { startLoading, stopLoading } from \"../utils/loading\";\r\nimport { port } from \"./config\";\r\nimport { handleContactList, isInContact, refreshContactList } from \"./contact\";\r\nimport { scrollToEndMessages } from \"./scroll\";\r\nimport { info } from \"./toast\";\r\n\r\nexport const loginHandler = async (\r\n  isKeepLogin: any,\r\n  token: any,\r\n  dispatch: any,\r\n  history: any\r\n) => {\r\n  const myWorkingPromise = await new Promise(async (resolve, reject) => {\r\n    if (isKeepLogin && !token) {\r\n      const { email, password, accessToken, refreshToken } =\r\n        JSON.parse(isKeepLogin);\r\n      const deviceData: any = localStorage.getItem(email);\r\n      try {\r\n        startLoading();\r\n        const { deviceName, deviceId } = JSON.parse(deviceData);\r\n        // const contactListLogs = await getContactListLogs(email);\r\n        // console.log(\"contactListLogs: \", contactListLogs);\r\n        const lastMessageTimeStamp = await getLastMessageTimeStamp(email);\r\n        const latestLogId = await getLatestContactLogid(email);\r\n        const user: any = await tryLoginApi(\r\n          email,\r\n          password,\r\n          deviceName,\r\n          deviceId,\r\n          lastMessageTimeStamp,\r\n          latestLogId,\r\n          accessToken,\r\n          refreshToken\r\n        );\r\n        let wsEndPoint = \"\";\r\n        if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n          // dev code\r\n          wsEndPoint = `ws://localhost:${port}`;\r\n        } else {\r\n          // production code\r\n          wsEndPoint = window.location.origin.replace(/^http/, \"ws\");\r\n        }\r\n        const socket = new WebSocket(wsEndPoint);\r\n        socket.onopen = () => {\r\n          console.log(\"Socket is open\");\r\n          socket.send(JSON.stringify({ key: \"setEmail\", value: email }));\r\n          dispatch(setWs(socket));\r\n        };\r\n        socket.onmessage = async (event) => {\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n            const { key } = data;\r\n            if (key === \"newMesssage\") {\r\n              const { text, sender, receiverUser, logId, sendAt, attachment } =\r\n                data;\r\n              console.log(\"newMesssage: \", data);\r\n              const { nickname: receiverUserName, intId: receiverIntId } =\r\n                receiverUser;\r\n              const { nickname: senderName, intId: senderIntId } = sender;\r\n              const newMessageObj = {\r\n                receiverUserName,\r\n                message: { attachment, text, received: true, sendAt, logId },\r\n                senderName,\r\n              };\r\n              await handleContactList(senderName, receiverUserName, email);\r\n              await updateContactLogid(email, logId);\r\n              const { currentFocus } = await store.getState();\r\n              if (\r\n                currentFocus === senderName ||\r\n                currentFocus === receiverUserName\r\n              ) {\r\n                dispatch(newMessage(newMessageObj));\r\n                dispatch(setSending(false));\r\n                scrollToEndMessages();\r\n              } else {\r\n                info(`New Message From ${senderName} to ${receiverUserName}`);\r\n              }\r\n              await refreshContactList();\r\n              const isInContactExists = await isInContact(senderName);\r\n              if (isInContactExists) {\r\n                await updateMessageLogs(\r\n                  email,\r\n                  receiverUserName,\r\n                  receiverIntId,\r\n                  newMessageObj,\r\n                  logId\r\n                );\r\n                await addNewMessageIdb(\r\n                  user.loggedInUserId,\r\n                  receiverIntId,\r\n                  newMessageObj\r\n                );\r\n              } else {\r\n                if (senderIntId === user.loggedInUserId) {\r\n                  await updateMessageLogs(\r\n                    email,\r\n                    receiverUserName,\r\n                    receiverIntId,\r\n                    newMessageObj,\r\n                    logId\r\n                  );\r\n                  await addNewMessageIdb(\r\n                    user.loggedInUserId,\r\n                    receiverIntId,\r\n                    newMessageObj\r\n                  );\r\n                } else {\r\n                  await updateMessageLogs(\r\n                    email,\r\n                    senderName,\r\n                    senderIntId,\r\n                    newMessageObj,\r\n                    logId\r\n                  );\r\n                  await addNewMessageIdb(\r\n                    user.loggedInUserId,\r\n                    senderIntId,\r\n                    newMessageObj\r\n                  );\r\n                }\r\n                await updatedLastMessageTimeStamp(email, sendAt);\r\n              }\r\n            } else if (key === \"unreadMessages\") {\r\n              const { userId, messageStore } = data.value;\r\n              console.log(userId, messageStore);\r\n            }\r\n          } catch (error) {\r\n            console.log(error);\r\n            stopLoading();\r\n            console.log(\"We have a message: \", event.data);\r\n          }\r\n        };\r\n        socket.onerror = () => {\r\n          alert(\"Socket has error\");\r\n        };\r\n        socket.onclose = (err) => {\r\n          alert(\"Socket is closed\");\r\n          console.log(err);\r\n          history.push(\"/login\");\r\n        };\r\n        dispatch(loginUser(user));\r\n        localStorage.setItem(\r\n          \"token\",\r\n          JSON.stringify({\r\n            accessToken: user.accessToken,\r\n            refreshToken: user.accessToken,\r\n            email,\r\n            password,\r\n          })\r\n        );\r\n        stopLoading();\r\n        history.push(\"/\");\r\n        resolve(true);\r\n      } catch (error) {\r\n        stopLoading();\r\n        localStorage.removeItem(\"token\");\r\n        history.push(\"/login\");\r\n        console.error(error);\r\n        reject(true);\r\n      }\r\n    } else {\r\n      console.log(\"Acoided +++++++++++++++++++\");\r\n      resolve(true);\r\n    }\r\n  });\r\n  return await myWorkingPromise;\r\n};\r\n","import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\nimport { loginHandler } from \"../../helpers/loginHandler\";\r\n\r\nclass Login extends React.Component<any> {\r\n  loginFormHandler = async (event: any) => {\r\n    const { history, dispatch }: any = this.props;\r\n    event.preventDefault();\r\n    const emailElem = document.getElementById(\"userEmail\") as HTMLInputElement;\r\n    const email = emailElem.value;\r\n\r\n    const passwordElem = document.getElementById(\r\n      \"userPassword\"\r\n    ) as HTMLInputElement;\r\n\r\n    const password = passwordElem.value;\r\n    const deviceData = localStorage.getItem(email);\r\n    if (!deviceData) {\r\n      alert(\"Please register device first\");\r\n    } else {\r\n      try {\r\n        await loginHandler(\r\n          JSON.stringify({ email, password }),\r\n          null,\r\n          dispatch,\r\n          history\r\n        );\r\n        history.push(\"/\");\r\n      } catch (error) {\r\n        console.error(error);\r\n        history.push(\"/login\");\r\n      }\r\n    }\r\n  };\r\n  render() {\r\n    return (\r\n      <>\r\n        <form className=\"m-3\" onSubmit={this.loginFormHandler}>\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"userEmail\" className=\"form-label\">\r\n              Email address\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              id=\"userEmail\"\r\n              required\r\n              aria-describedby=\"emailHelp\"\r\n            />\r\n            <div id=\"emailHelp\" className=\"form-text\">\r\n              We'll never share your email with anyone else.\r\n            </div>\r\n          </div>\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"userPassword\" className=\"form-label\">\r\n              Password\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              className=\"form-control\"\r\n              autoComplete=\"true\"\r\n              required\r\n              id=\"userPassword\"\r\n            />\r\n          </div>\r\n          <button type=\"submit\" className=\"btn btn-outline-light m-2\">\r\n            Login\r\n          </button>\r\n          <Link to=\"/register\">\r\n            <button type=\"submit\" className=\"btn btn-outline-info\">\r\n              Register Device\r\n            </button>\r\n          </Link>\r\n        </form>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    chatList: state.user.chatList,\r\n    currentFocus: state.currentFocus,\r\n  };\r\n};\r\nexport default connect(mapStateToProps)(withRouter(Login));\r\n","import { port } from \"../helpers/config\";\r\nimport { errors } from \"../helpers/errorCodes\";\r\n\r\nexport const trySendDeviceRegisterApi = async (\r\n  deviceName: string,\r\n  deviceId: string,\r\n  email: string,\r\n  password: string\r\n) => {\r\n  const requestOptions = {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ deviceName, deviceId, email, password }),\r\n  };\r\n  let apiEndPoint = \"\";\r\n  if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n    // dev code\r\n    apiEndPoint = `http://localhost:${port}/device/sendCode`;\r\n  } else {\r\n    // production code\r\n    apiEndPoint = \"/device/sendCode\";\r\n  }\r\n  let result: any = await fetch(apiEndPoint, requestOptions);\r\n  result = await result.json();\r\n  if (result.error) {\r\n    const errorMessage = result.message;\r\n    alert(errorMessage);\r\n    console.log(\"result: \", errorMessage);\r\n  } else {\r\n    alert(result.message);\r\n    console.log(result.message);\r\n  }\r\n};\r\n\r\nexport const trySetDeviceRegisterApi = async (\r\n  code: string,\r\n  email: string,\r\n  password: string\r\n) => {\r\n  const setCodePromise = new Promise(async (resolve, reject) => {\r\n    const requestOptions = {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ code, email, password }),\r\n    };\r\n    let apiEndPoint = \"\";\r\n    if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n      // dev code\r\n      apiEndPoint = `http://localhost:${port}/device/setCode`;\r\n    } else {\r\n      // production code\r\n      apiEndPoint = \"/device/setCode\";\r\n    }\r\n    let result: any = await fetch(apiEndPoint, requestOptions);\r\n    result = await result.json();\r\n    if (result.error) {\r\n      let errorMessage = errors[`${result.error}`];\r\n      if (!errorMessage) {\r\n        errorMessage = result.message;\r\n      }\r\n      alert(errorMessage);\r\n      console.log(\"result: \", result);\r\n      console.log(\"errorMessage: \", errorMessage);\r\n      reject(errorMessage);\r\n    } else {\r\n      resolve(result.message);\r\n      alert(result.message);\r\n      console.log(result);\r\n    }\r\n  });\r\n\r\n  return await setCodePromise;\r\n};\r\n","import { useState } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport { v4 as randomId } from \"uuid\";\r\nimport {\r\n  trySendDeviceRegisterApi,\r\n  trySetDeviceRegisterApi,\r\n} from \"../../api/device\";\r\n\r\nconst RegisterDevice = () => {\r\n  const history = useHistory();\r\n\r\n  const [deviceName, setDeviceName] = useState(\"\");\r\n  const [isLoadingSend, setLoadingSend] = useState(false);\r\n  const [isLoadingRegister, setLoadingRegister] = useState(false);\r\n\r\n  const registerFormHandler = async (event: any) => {\r\n    event.preventDefault();\r\n    const emailElem = document.getElementById(\"userEmail\") as HTMLInputElement;\r\n    const email = emailElem.value;\r\n    const passwordElem = document.getElementById(\r\n      \"userPassword\"\r\n    ) as HTMLInputElement;\r\n\r\n    const password = passwordElem.value;\r\n    let deviceId = randomId();\r\n    deviceId = deviceId.split(\"-\").join(\"\");\r\n    console.log(\"deviceId: \", deviceId);\r\n    try {\r\n      setLoadingSend(true);\r\n      await trySendDeviceRegisterApi(deviceName, deviceId, email, password);\r\n      localStorage.setItem(email, JSON.stringify({ deviceName, deviceId }));\r\n      setLoadingSend(false);\r\n      console.log(\"deviceName: \", deviceName);\r\n      console.log(\"deviceId: \", deviceId);\r\n    } catch (error) {\r\n      console.error(error);\r\n      setLoadingSend(false);\r\n    }\r\n  };\r\n\r\n  const registerCodeFormHandler = async (event: any) => {\r\n    event.preventDefault();\r\n    const emailElem = document.getElementById(\"userEmail\") as HTMLInputElement;\r\n    const email = emailElem.value;\r\n    const passwordElem = document.getElementById(\r\n      \"userPassword\"\r\n    ) as HTMLInputElement;\r\n\r\n    const password = passwordElem.value;\r\n    const registerCodeElem = document.getElementById(\r\n      \"registerCode\"\r\n    ) as HTMLInputElement;\r\n    const registerCode = registerCodeElem.value;\r\n    try {\r\n      setLoadingRegister(true);\r\n      await trySetDeviceRegisterApi(registerCode, email, password);\r\n      setLoadingRegister(false);\r\n      history.push(\"/login\");\r\n    } catch (error) {\r\n      console.error(error);\r\n      setLoadingRegister(false);\r\n    }\r\n  };\r\n  return (\r\n    <div>\r\n      <form className=\"m-3\" onSubmit={registerFormHandler}>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"userEmail\" className=\"form-label\">\r\n            Email address\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            id=\"userEmail\"\r\n            required\r\n            aria-describedby=\"emailHelp\"\r\n          />\r\n          <div id=\"emailHelp\" className=\"form-text\">\r\n            We'll never share your email with anyone else.\r\n          </div>\r\n        </div>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"userPassword\" className=\"form-label\">\r\n            Password\r\n          </label>\r\n          <input\r\n            type=\"password\"\r\n            className=\"form-control\"\r\n            autoComplete=\"true\"\r\n            required\r\n            id=\"userPassword\"\r\n          />\r\n        </div>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"machineName\" className=\"form-label\">\r\n            Enter Device Name To Save\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-control\"\r\n            placeholder=\"Office Pc\"\r\n            id=\"machineName\"\r\n            onInput={(event: any) => setDeviceName(event.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n        <button type=\"submit\" className=\"btn btn-outline-light m-2\">\r\n          {isLoadingSend ? (\r\n            <span\r\n              className=\"spinner-grow spinner-grow-sm\"\r\n              role=\"status\"\r\n              aria-hidden=\"true\"\r\n            ></span>\r\n          ) : (\r\n            \"Send Code\"\r\n          )}\r\n        </button>\r\n        <Link to=\"/login\">\r\n          <button type=\"submit\" className=\"btn btn-outline-info\">\r\n            Login\r\n          </button>\r\n        </Link>\r\n      </form>\r\n      <form className=\"m-3\" onSubmit={registerCodeFormHandler}>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"registerCode\" className=\"form-label\">\r\n            Enter code\r\n          </label>\r\n          <input\r\n            type=\"number\"\r\n            placeholder=\"1234\"\r\n            className=\"form-control\"\r\n            id=\"registerCode\"\r\n            required\r\n          />\r\n        </div>\r\n        <button type=\"submit\" className=\"btn btn-outline-light m-2\">\r\n          {isLoadingRegister ? (\r\n            <span\r\n              className=\"spinner-grow spinner-grow-sm\"\r\n              role=\"status\"\r\n              aria-hidden=\"true\"\r\n            ></span>\r\n          ) : (\r\n            \"Register\"\r\n          )}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RegisterDevice;\r\n","export default __webpack_public_path__ + \"static/media/profile.a9136072.png\";","import { useSelector } from \"react-redux\";\r\nimport profile from \"../../assets/images/profile.png\";\r\n\r\nimport \"./chatListItem.css\";\r\n\r\nconst ChatListItem = ({\r\n  name,\r\n  profileImage,\r\n  newChatCount,\r\n  onClickHandler,\r\n}: any) => {\r\n  const currentFocus = useSelector((state: any) => state.currentFocus);\r\n  return (\r\n    <div\r\n      className={`chatListItemContainer border rounded d-flex flex-row w-10 m-2 p-2 ${\r\n        currentFocus === name && \"focusedContact\"\r\n      }`}\r\n      onClick={onClickHandler}\r\n    >\r\n      <div>\r\n        <img\r\n          src={profileImage ? profileImage : profile}\r\n          className=\"rounded-circle profileWidth\"\r\n          alt=\"profileImage\"\r\n        />\r\n        <h3 className=\"d-inline contactName\">{name}</h3>\r\n      </div>\r\n      {/* {newChatCount > 0 && currentFocus !== name && (\r\n        <div>\r\n          <h3 className=\"d-inline contactName text-danger\">({newChatCount})</h3>\r\n        </div>\r\n      )} */}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatListItem;\r\n","import moment from \"moment\";\r\n// import blobToSHA1 from \"blob-to-sha1\";\r\n// import axios from \"axios\";\r\nimport { useEffect } from \"react\";\r\n// import { deleteDB, openDB } from \"idb\";\r\n\r\nimport { useSelector } from \"react-redux\";\r\nimport { scrollToEndMessages } from \"../../helpers/scroll\";\r\n// import { getImgBlobFromIdb } from \"../../idb/messages\";\r\n\r\nimport \"./chatWindow.css\";\r\n\r\nconst ChatWindow = () => {\r\n  const { chat, currentFocus, chatLoading }: any = useSelector((state: any) => {\r\n    const { chat, currentFocus, chatLoading } = state;\r\n    chat.sort((a: any, b: any) => {\r\n      return a.sendAt - b.sendAt;\r\n    });\r\n    return { chat, currentFocus, chatLoading };\r\n  });\r\n  const imageOnClickHandler = async (message: any) => {\r\n    let image = document.createElement(\"img\");\r\n    image.src = message.attachment.url;\r\n    let w: any = window.open(\"\", \"_blank\");\r\n    w.document.title = \"AlivaKakaoClient\";\r\n    w.document.title = \"AlivaKakaoClient\";\r\n    w.document.body.appendChild(image);\r\n    w.location.href = message.attachment.url;\r\n  };\r\n\r\n  // const getSha1 = async (p1: any) => {\r\n  //   if (p1) {\r\n  //     const blob: any = await getImgBlobFromIdb(p1);\r\n  //     const hash = await blobToSHA1(blob);\r\n  //     console.log(hash);\r\n  //   }\r\n  // };\r\n\r\n  useEffect(() => {\r\n    scrollToEndMessages();\r\n  }, [chatLoading, chat]);\r\n  return (\r\n    <div className=\"m-2\" id=\"chatWindowContainer\">\r\n      <h1>Chat Window</h1>\r\n      {chatLoading && \"Loading.....\"}\r\n      {!chatLoading &&\r\n        chat?.length > 0 &&\r\n        chat.map((message: any, index: number) => (\r\n          <div\r\n            key={index}\r\n            className={`text-light p-1 w-100 d-flex flex-row ${\r\n              currentFocus === message.receiverUserName\r\n                ? \"justify-content-end\"\r\n                : \"justify-content-start\"\r\n            }`}\r\n          >\r\n            <div\r\n              className={`border border-dark rounded p-1 ${\r\n                currentFocus === message.receiverUserName\r\n                  ? \"receiverMessage\"\r\n                  : \"senderMessage\"\r\n              }`}\r\n            >\r\n              {(message.text === \"photo\" || message.text === \"사진\") &&\r\n                message.attachment &&\r\n                message.attachment.thumbnailUrl && (\r\n                  <img\r\n                    loading=\"lazy\"\r\n                    alt=\"userImages\"\r\n                    src={\r\n                      message.attachment.thumbnail\r\n                        ? message.attachment.thumbnail\r\n                        : message.attachment.thumbnailUrl\r\n                    }\r\n                    onClick={() => imageOnClickHandler(message)}\r\n                    className=\"hoverPointer p-1\"\r\n                    width=\"90\"\r\n                    height=\"90\"\r\n                  />\r\n                )}\r\n              {message.text === \"voice note\" && (\r\n                <audio controls src={message.attachment.url}></audio>\r\n              )}\r\n              {message.text !== \"photo\" &&\r\n                message.text !== \"voice note\" &&\r\n                !message?.attachment?.name &&\r\n                (!message?.attachment || !message.attachment?.thumbnailUrl) && (\r\n                  <span className=\"m-1 text-wrap\">{message.text}</span>\r\n                )}\r\n              {message?.attachment?.name && (\r\n                <span className=\"m-1 text-wrap\">\r\n                  {message?.attachment?.alt}\r\n                </span>\r\n              )}\r\n              <span className=\"small bg-secondary makeItLight rounded p-1\">\r\n                {moment(message.sendAt).format(\"hh:mm:ss A DD/MM/YYYY\")}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;\r\n","import { port } from \"../helpers/config\";\r\nimport { store } from \"../redux\";\r\n\r\nexport const uploadFile = async (file: any) => {\r\n  const fileUploadPromise = new Promise(async (resolve, reject) => {\r\n    try {\r\n      const {\r\n        user: { accessToken },\r\n      } = store.getState();\r\n      if (accessToken) {\r\n        console.log(\"accessToken: \", accessToken);\r\n        var data = new FormData();\r\n        data.append(\"myFile\", file);\r\n        const requestOptions = {\r\n          method: \"POST\",\r\n          body: data,\r\n        };\r\n        let apiEndPoint = \"\";\r\n        if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n          // dev code\r\n          apiEndPoint = `http://localhost:${port}/uploadfile`;\r\n        } else {\r\n          // production code\r\n          apiEndPoint = \"/uploadfile\";\r\n        }\r\n        let result: any = await fetch(apiEndPoint, requestOptions);\r\n        result = await result.json();\r\n        console.log(\"result: \", result);\r\n        resolve(result);\r\n      }\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  });\r\n  return await fileUploadPromise;\r\n};\r\n","import { useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { uploadFile } from \"../../api/file\";\r\n// import { errors } from \"../../helpers/errorCodes\";\r\nimport { error } from \"../../helpers/toast\";\r\nimport { setSending } from \"../../redux/action/user\";\r\nimport \"./messageInput.css\";\r\n\r\nconst MessageInput = () => {\r\n  const [currentSelectedFile, setSelectedFile] = useState({ name: \"\" });\r\n  const currentFocus = useSelector((state: any) => state.currentFocus);\r\n  const email = useSelector((state: any) => state.user.email);\r\n  // const loggedInUserId = useSelector((state: any) => state.loggedInUserId);\r\n  const chatList = useSelector((state: any) => state.user.chatList);\r\n  const isSending = useSelector((state: any) => state.isSending);\r\n  const ws = useSelector((state: any) => state.ws);\r\n  const dispatch = useDispatch();\r\n  const [message, setMessage] = useState(\"\");\r\n  const handlePaste = async (e: any) => {\r\n    if (e.clipboardData.files.length) {\r\n      const fileObject = e.clipboardData.files[0];\r\n      setSelectedFile(fileObject);\r\n      console.log(currentSelectedFile);\r\n    } else {\r\n      alert(\r\n        \"No image data was found in your clipboard. Copy an image first or take a screenshot.\"\r\n      );\r\n    }\r\n  };\r\n  const sendMessageHandler = async (event: any) => {\r\n    try {\r\n      event.preventDefault();\r\n      // const sendAt = new Date().getTime();\r\n      const userFileUpload: any = document.getElementById(\r\n        \"userFileUpload\"\r\n      ) as HTMLInputElement;\r\n      if (!currentFocus) {\r\n        alert(\"Please a contact first\");\r\n        return;\r\n      }\r\n      if (\r\n        !message &&\r\n        userFileUpload.files.length <= 0 &&\r\n        !currentSelectedFile\r\n      ) {\r\n        alert(\"Plase select a file or type some message\");\r\n        return;\r\n      }\r\n      dispatch(setSending(true));\r\n      if (userFileUpload.files.length > 0 || currentSelectedFile) {\r\n        if (currentSelectedFile.name) {\r\n          console.log(\"this. should not call: \", currentSelectedFile);\r\n          const { path }: any = await uploadFile(currentSelectedFile);\r\n          const channelId = chatList[currentFocus][`channelId`];\r\n          ws.send(\r\n            JSON.stringify({\r\n              key: \"newMessageFile\",\r\n              value: {\r\n                message,\r\n                receiver: currentFocus,\r\n                filePath: path,\r\n                email,\r\n                channelId,\r\n              },\r\n            })\r\n          );\r\n          setSelectedFile({ name: \"\" });\r\n        } else {\r\n          for (const file in userFileUpload.files) {\r\n            if (\r\n              Object.prototype.hasOwnProperty.call(userFileUpload.files, file)\r\n            ) {\r\n              const selectedFile: any = userFileUpload.files[file];\r\n              const { path }: any = await uploadFile(selectedFile);\r\n              const channelId = chatList[currentFocus][`channelId`];\r\n              ws.send(\r\n                JSON.stringify({\r\n                  key: \"newMessageFile\",\r\n                  value: {\r\n                    message,\r\n                    receiver: currentFocus,\r\n                    filePath: path,\r\n                    email,\r\n                    channelId,\r\n                  },\r\n                })\r\n              );\r\n            }\r\n          }\r\n        }\r\n        userFileUpload.value = \"\";\r\n        setSelectedFile({ name: \"\" });\r\n      } else {\r\n        console.log(currentFocus);\r\n        const channelId = chatList[currentFocus][`channelId`];\r\n        ws.send(\r\n          JSON.stringify({\r\n            key: \"newMessage\",\r\n            value: { message, receiver: currentFocus, email, channelId },\r\n          })\r\n        );\r\n        setMessage(\"\");\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      error(\"Error in sending message\");\r\n      dispatch(setSending(false));\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"messageInputContainer\">\r\n      <span className=\"m-2\">\r\n        Selected file{\" \"}\r\n        <span className=\"text-danger\">{currentSelectedFile.name}</span>\r\n      </span>\r\n      <form\r\n        className=\"m-2\"\r\n        onSubmit={sendMessageHandler}\r\n        encType=\"multipart/form-data\"\r\n      >\r\n        <div>\r\n          <input\r\n            type=\"text\"\r\n            autoFocus\r\n            className=\"form-control\"\r\n            onInput={(event: any) => setMessage(event.target.value)}\r\n            value={message}\r\n            onPaste={handlePaste}\r\n          />\r\n        </div>\r\n        <div className=\"form-group mt-2\">\r\n          <input\r\n            type=\"file\"\r\n            className=\"form-control-file\"\r\n            id=\"userFileUpload\"\r\n            accept=\"image/*\"\r\n          />\r\n        </div>\r\n        <button\r\n          disabled={isSending ? true : false}\r\n          className=\"btn btn-outline-light mt-2\"\r\n          type=\"submit\"\r\n        >\r\n          {isSending ? (\r\n            <span\r\n              className=\"spinner-grow spinner-grow-sm\"\r\n              role=\"status\"\r\n              aria-hidden=\"true\"\r\n            ></span>\r\n          ) : (\r\n            \"Send\"\r\n          )}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessageInput;\r\n","import ChatWindow from \"../chatWindow/chatWindow\";\r\nimport MessageInput from \"../messageInput/messageInput\";\r\n\r\nconst Messages = () => {\r\n  return (\r\n    <div>\r\n      <ChatWindow />\r\n      <MessageInput />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messages;\r\n","import { port } from \"../helpers/config\";\r\n// import { startLoading, stopLoading } from \"../utils/loading\";\r\n\r\nexport const getUserChat = async (\r\n  email: string,\r\n  nickNameToGetChat: string,\r\n  lastMessageTimeStamp: any,\r\n  lastChatLogId: any,\r\n  logId: any\r\n) => {\r\n  const setCodePromise = new Promise(async (resolve, reject) => {\r\n    const requestOptions = {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        email,\r\n        nickNameToGetChat,\r\n        lastMessageTimeStamp,\r\n        lastChatLogId,\r\n        startChatLogId: logId,\r\n      }),\r\n    };\r\n    let apiEndPoint = \"\";\r\n    if (!process.env.NODE_ENV || process.env.NODE_ENV === \"development\") {\r\n      // dev code\r\n      apiEndPoint = `http://localhost:${port}/chat`;\r\n    } else {\r\n      // production code\r\n      apiEndPoint = \"/chat\";\r\n    }\r\n    let result: any = await fetch(apiEndPoint, requestOptions);\r\n    result = await result.json();\r\n    if (result.error) {\r\n      let errorMessage = result.message;\r\n      alert(errorMessage);\r\n      console.log(\"result: \", result);\r\n      console.log(\"errorMessage: \", errorMessage);\r\n      reject(errorMessage);\r\n    } else {\r\n      const { userId, messages } = result.data;\r\n      resolve({ userId, messages });\r\n      console.log(result);\r\n    }\r\n  });\r\n\r\n  return await setCodePromise;\r\n};\r\n","export const convertFileToBase64 = async (file: any) => {\r\n  const base64Promise = new Promise((resolve, reject) => {\r\n    try {\r\n      var reader = new FileReader();\r\n      reader.onload = function (e: any) {\r\n        // The file's text will be printed here\r\n        resolve(e.target.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  });\r\n\r\n  return await base64Promise;\r\n};\r\n\r\nexport const readBlobText = async (blob: any) => {\r\n  const base64Promise = new Promise((resolve, reject) => {\r\n    try {\r\n      var reader = new FileReader();\r\n      reader.onload = function (e: any) {\r\n        // The file's text will be printed here\r\n        resolve(e.target.result);\r\n      };\r\n      reader.readAsText(blob);\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  });\r\n\r\n  return await base64Promise;\r\n};\r\n","import { getUserChat } from \"../api/chat\";\r\nimport { getLatestContactLogid } from \"../idb/contacts\";\r\nimport {\r\n  getImgBlobFromIdb,\r\n  handleIncommingMessages,\r\n  lastDbMessageTime,\r\n} from \"../idb/messages\";\r\nimport { store } from \"../redux\";\r\nimport { loadChat, setFocusUser } from \"../redux/action/user\";\r\nimport { readBlobText } from \"./file\";\r\nimport { scrollToEndMessages } from \"./scroll\";\r\n\r\nexport const refreshMessages = async (focusedName: string) => {\r\n  try {\r\n    const { loggedInUserId, user }: any = await store.getState();\r\n    const { dispatch } = store;\r\n    const lastChatLogId = getLatestContactLogid(user.email);\r\n    const focusedUserId = user.chatList[focusedName]?.intId;\r\n    dispatch(setFocusUser(focusedName));\r\n    const { allMessages, lastMessageTimeStamp, logId }: any =\r\n      await lastDbMessageTime(loggedInUserId, focusedUserId);\r\n    const { messages }: any = await getUserChat(\r\n      user.email,\r\n      focusedName,\r\n      lastMessageTimeStamp,\r\n      lastChatLogId,\r\n      logId\r\n    );\r\n    const messagesToSet = [...messages, ...allMessages];\r\n    let imgPromisesChat = messagesToSet.map(async (message: any) => {\r\n      if (message.text === \"photo\"|| message.text === \"사진\") {\r\n        const imgBlob = await getImgBlobFromIdb(\r\n          message.attachment.thumbnailKey || \"\"\r\n        );\r\n        if (imgBlob) {\r\n          const base64 = await readBlobText(imgBlob);\r\n          message.thumbnail = `data:${message.attachment.mt};base64,${base64}`;\r\n          console.log(\"imgBlob: \", imgBlob);\r\n          console.log(\"base64: \", message.thumbnail);\r\n        }\r\n      }\r\n      return message;\r\n    });\r\n    imgPromisesChat = await Promise.all(imgPromisesChat);\r\n    dispatch(loadChat(imgPromisesChat));\r\n    await handleIncommingMessages(\r\n      imgPromisesChat,\r\n      loggedInUserId,\r\n      focusedUserId\r\n    );\r\n    scrollToEndMessages();\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n","import { connect, useDispatch } from \"react-redux\";\r\n\r\nimport ChatListItem from \"../../components/chatListItem/chatListItem\";\r\nimport Messages from \"../../components/messages/messages\";\r\nimport { refreshContactList } from \"../../helpers/contact\";\r\nimport { refreshMessages } from \"../../helpers/messages\";\r\nimport {\r\n  setStartChatLoading,\r\n  setStopChatLoading,\r\n} from \"../../redux/action/user\";\r\n\r\nimport \"./home.css\";\r\n\r\nconst Home = (props: any) => {\r\n  const dispatch = useDispatch();\r\n  const onClickHandler = async (name: string) => {\r\n    dispatch(setStartChatLoading());\r\n    await refreshMessages(name);\r\n    await refreshContactList();\r\n    dispatch(setStopChatLoading());\r\n  };\r\n\r\n  const getChatListItems = () => {\r\n    const items = [];\r\n    let index = 0;\r\n    const chatList = props.user.chatList;\r\n    for (const key in chatList) {\r\n      if (Object.prototype.hasOwnProperty.call(chatList, key)) {\r\n        const item = chatList[key];\r\n        items.push(\r\n          <ChatListItem\r\n            profileImage={item.displayUserList[0].profileURL}\r\n            name={item.displayUserList[0].nickname}\r\n            newChatCount={item.newChatCount}\r\n            key={index}\r\n            onClickHandler={() => {\r\n              return onClickHandler(item.displayUserList[0].nickname);\r\n            }}\r\n          />\r\n        );\r\n        index++;\r\n      }\r\n    }\r\n\r\n    return items;\r\n  };\r\n  return (\r\n    <div className=\"d-flex rounded\" id=\"homeMainContainer\">\r\n      <div className=\"chatListContainer border rounded d-flex flex-column flex-wrap m-2 justify-content-center\">\r\n        {/* <ChatListItem\r\n          profileImage=\"https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500\"\r\n          name=\"amir\"\r\n        />{\" \"}\r\n        <ChatListItem\r\n          profileImage=\"https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500\"\r\n          name=\"ali\"\r\n        /> */}\r\n        {props.user.chatList ? getChatListItems() : \"\"}\r\n      </div>\r\n      <div className=\"border m-2 rounded\" id=\"messageContainer\">\r\n        <Messages />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    user: state.user,\r\n    loggedInUserId: state.loggedInUserId,\r\n    ws: state.ws,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Home);\r\n","import { useDispatch, useSelector } from \"react-redux\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport { logoutUserNodejs } from \"../../../api/user\";\r\nimport { logoutUser } from \"../../../redux/action/user\";\r\nimport { startLoading, stopLoading } from \"../../../utils/loading\";\r\n\r\nconst PrivateNavItems = ({ email }: any) => {\r\n  const ws = useSelector((state: any) => state.ws);\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n  const logOutHandler = async () => {\r\n    startLoading();\r\n    await logoutUserNodejs(email);\r\n    dispatch(logoutUser());\r\n    localStorage.removeItem(\"token\");\r\n    history.push(\"/login\");\r\n    ws.close();\r\n    stopLoading();\r\n  };\r\n  return (\r\n    <>\r\n      <li className=\"nav-item\">\r\n        <Link className=\"nav-link active\" aria-current=\"page\" to=\"/\">\r\n          Home\r\n        </Link>\r\n      </li>\r\n      <li className=\"nav-item\">\r\n        <span className=\"nav-link active\">{email}</span>\r\n      </li>\r\n      <li className=\"nav-item hoverEffect\" onClick={logOutHandler}>\r\n        <span className=\"nav-link active\">Logout</span>\r\n      </li>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PrivateNavItems;\r\n","import { Link } from \"react-router-dom\";\r\n\r\nconst PublicNavItems = () => {\r\n  return (\r\n    <>\r\n      <li className=\"nav-item\">\r\n        <Link className=\"nav-link active\" to=\"/login\">\r\n          Login\r\n        </Link>\r\n      </li>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PublicNavItems;\r\n","import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\n\r\nimport PrivateNavItems from \"./privateNavItems/privateNavItems\";\r\nimport PublicNavItems from \"./publicNavItems/publicNavItems\";\r\n\r\nimport { loginHandler } from \"../../helpers/loginHandler\";\r\n// import { getImg } from \"../../api/media\";\r\n\r\nclass Navbar extends React.Component<any> {\r\n  async componentDidMount() {\r\n    const isKeepLogin = localStorage.getItem(\"token\");\r\n    const { dispatch, history, token }: any = this.props;\r\n    try {\r\n      await loginHandler(isKeepLogin, token, dispatch, history);\r\n    } catch (error) {}\r\n  }\r\n  render() {\r\n    const { token, email }: any = this.props;\r\n    return (\r\n      <nav className=\"navbar navbar-expand-lg navbar-dark bg-dark\">\r\n        <div className=\"container-fluid\">\r\n          <button\r\n            className=\"navbar-toggler\"\r\n            type=\"button\"\r\n            data-bs-toggle=\"collapse\"\r\n            data-bs-target=\"#alivaNavbar\"\r\n            aria-controls=\"alivaNavbar\"\r\n            aria-expanded=\"false\"\r\n            aria-label=\"Toggle navigation\"\r\n          >\r\n            <span className=\"navbar-toggler-icon\"></span>\r\n          </button>\r\n          <div className=\"collapse navbar-collapse\" id=\"alivaNavbar\">\r\n            <Link className=\"navbar-brand\" to=\"/\">\r\n              AlivaTech\r\n            </Link>\r\n            <ul className=\"navbar-nav me-auto mb-2 mb-lg-0\">\r\n              {token ? <PrivateNavItems email={email} /> : <PublicNavItems />}\r\n              {/* <li>\r\n                <button onClick={getImg}>getImg</button>\r\n              </li> */}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    token: state.user.accessToken,\r\n    email: state.user.email,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(withRouter(Navbar));\r\n","import { Route } from \"react-router\";\r\n\r\nconst Public = ({ component: Component, token, ...rest }: any) => (\r\n  <Route\r\n    {...rest}\r\n    render={(props: any) => {\r\n      return <Component {...props} />;\r\n    }}\r\n  />\r\n);\r\nexport default Public;\r\n","import { connect } from \"react-redux\";\r\nimport { Redirect, Route } from \"react-router\";\r\n\r\nconst Private = ({ component: Component, token, loading, ...rest }: any) => (\r\n  <Route\r\n    {...rest}\r\n    render={(props) => {\r\n      console.log(\"token: \", token);\r\n      if (!token && !loading) {\r\n        return <Redirect to={{ pathname: \"/login\" }} />;\r\n      } else {\r\n        return <Component {...props} />;\r\n      }\r\n    }}\r\n  />\r\n);\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    token: state.user.accessToken,\r\n    loading: state.loading,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Private);\r\n","import ReactLoading from \"react-loading\";\r\n\r\nimport \"./loading.css\";\r\n\r\nconst Loading = () => (\r\n  <div className=\"loadingContainer\">\r\n    <ReactLoading\r\n      className=\"setMarginLoading\"\r\n      type=\"spin\"\r\n      color=\"white\"\r\n      height={\"2%\"}\r\n      width={\"2%\"}\r\n    />\r\n    <h1 className=\"m-3\">Loading.....</h1>\r\n    <br />\r\n    <h2 id=\"loginTryMessage\">{\"\"}</h2>\r\n  </div>\r\n);\r\n\r\nexport default Loading;\r\n","import { BrowserRouter } from \"react-router-dom\";\r\nimport { ToastContainer } from \"react-toastify\";\r\n\r\nimport Login from \"../pages/login/login\";\r\nimport RegisterDevice from \"../pages/registerDevice/registerDevice\";\r\nimport Home from \"../pages/home/home\";\r\nimport Navbar from \"../components/navbar/navbar\";\r\nimport Public from \"./public/public\";\r\nimport { connect } from \"react-redux\";\r\nimport Private from \"./private/private\";\r\nimport React from \"react\";\r\nimport Loading from \"../components/loading/loading\";\r\n\r\nclass MainRouter extends React.Component {\r\n  render() {\r\n    const { loading }: any = this.props;\r\n    return (\r\n      <>\r\n        <BrowserRouter>\r\n          <ToastContainer />\r\n          <Navbar />\r\n          {loading ? (\r\n            <Loading />\r\n          ) : (\r\n            <>\r\n              <Private exact path=\"/\" component={Home} />\r\n              <Public exact path=\"/login\" component={Login} />\r\n              <Public exact path=\"/register\" component={RegisterDevice} />\r\n            </>\r\n          )}\r\n        </BrowserRouter>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    loading: state.loading,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(MainRouter);\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport \"./index.css\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport { store } from \"./redux\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport Router from \"./routes\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <Router />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}